<!doctype html>
<html lang="tr">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SomTech RU - SipariÅŸ Onay Formu</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://html2canvas.js.org/dist/html2canvas.min.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
            font-family: 'Calibri', 'Arial', sans-serif;
        }
        
        @media print {
            .no-print { display: none !important; }
            body { 
                background: white !important; 
                margin: 0;
                padding: 0;
            }
            .print-page { 
                width: 210mm; 
                min-height: 297mm; 
                margin: 0; 
                padding: 18mm 14mm;
                box-shadow: none;
                border: 1px solid #e5e7eb;
                background: white;
            }
            .table-cell input {
                border: none !important;
                background: transparent !important;
                color: black !important;
            }
            .signature-line {
                border-bottom: 2px solid #000 !important;
                background: transparent !important;
            }
        }
        
        .print-page {
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
            margin: 20px auto;
            max-width: 210mm;
            min-height: 297mm;
            padding: 18mm 14mm;
        }
        
        /* Responsive tasarÄ±m */
        @media (max-width: 1024px) {
            .print-page {
                margin: 10px;
                padding: 15mm;
                max-width: 100%;
            }
            
            .table-cell {
                padding: 4px 2px;
                font-size: 10px;
            }
            
            input[type="text"], input[type="number"], input[type="date"] {
                font-size: 10px;
                padding: 2px 4px;
            }
        }
        
        @media (max-width: 768px) {
            .print-page {
                padding: 10mm;
            }
            
            .grid-cols-3 {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .table-cell {
                padding: 3px 1px;
                font-size: 9px;
            }
            
            .overflow-x-auto {
                overflow-x: scroll;
            }
            
            table {
                min-width: 800px;
            }
        }
        
        @media (max-width: 480px) {
            .flex {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .flex-1 {
                text-align: center;
            }
            
            .text-xl {
                font-size: 1rem;
            }
            
            .text-lg {
                font-size: 0.9rem;
            }
        }
        
        input[type="text"], input[type="number"], input[type="date"] {
            border: 1px solid #d1d5db;
            padding: 4px 8px;
            font-size: 12px;
            width: 100%;
        }
        
        .table-cell {
            border: 1px solid #374151;
            padding: 8px 4px;
            text-align: center;
            vertical-align: middle;
        }
        
        .signature-line {
            border-bottom: 2px solid #000;
            height: 40px;
            margin-bottom: 5px;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="bg-gray-100 min-h-full">
  <div class="print-page"><!-- Ãœst BÃ¶lÃ¼m -->
   <div class="mb-8"><!-- Logo ve Tarih -->
    <div class="flex justify-between items-start mb-6">
     <div class="flex-shrink-0"><img src="https://www.somtech.com.tr/wp-content/uploads/2024/01/logo.png" alt="SomTech Logo" class="h-16" style="width: 120px; height: auto;" onerror="this.style.display='none';">
     </div>
     <div class="flex-shrink-0 text-right">
      <div class="bg-gray-100 px-4 py-2 rounded-lg border"><span class="text-sm font-semibold text-gray-700">ðŸ“… Tarih: </span> <span id="current-date" class="text-sm font-bold"></span>
      </div>
     </div>
    </div><!-- BaÅŸlÄ±k - OrtalanmÄ±ÅŸ -->
    <div class="text-center mb-6">
     <h1 id="form-title" class="text-2xl font-bold text-gray-800 mb-3">SÄ°PARÄ°Åž ONAY FORMU (SOF)</h1>
     <div class="w-full h-0.5 mb-4" style="background-color: #cf2e26;"></div>
     <p id="company-info" class="text-base font-semibold text-gray-600">RF100, SOMTECH RU, FABRÄ°KA MÃœDÃœRLÃœÄžÃœ</p>
    </div>
   </div><!-- Tablo -->
   <div class="overflow-x-auto mb-6">
    <table class="w-full border-collapse border-2 border-gray-800 text-xs">
     <thead>
      <tr class="bg-blue-800 text-white">
       <th class="table-cell w-12">SIRA NO</th>
       <th class="table-cell w-24">Ä°STENEN TESLÄ°M TARÄ°HÄ°</th>
       <th class="table-cell w-32">TALEP EDÄ°LEN MALZEME</th>
       <th class="table-cell w-28">DETAY 1 (MARKA, MODEL VB)</th>
       <th class="table-cell w-28">DETAY 2 (PROJE, STANDART VB KODLAR)</th>
       <th class="table-cell w-16">BÄ°RÄ°M</th>
       <th class="table-cell w-20">TALEP MÄ°KTARI</th>
       <th class="table-cell w-20">SÄ°PARÄ°Åž MÄ°KTARI</th>
       <th class="table-cell w-24">BÄ°RÄ°M FÄ°YAT (â‚½ RUB)</th>
       <th class="table-cell w-24">TOPLAM FÄ°YAT (â‚½ RUB)</th>
      </tr>
     </thead>
     <tbody id="table-body"><!-- SatÄ±rlar buraya eklenecek -->
     </tbody>
     <tfoot>
      <tr class="bg-gray-200">
       <td colspan="9" class="table-cell text-right font-bold">GENEL TOPLAM (â‚½ RUB):</td>
       <td class="table-cell font-bold text-lg" id="grand-total">0.00</td>
      </tr>
     </tfoot>
    </table>
   </div><!-- Butonlar -->
   <div class="flex flex-wrap gap-3 mb-6 no-print justify-center md:justify-start"><button onclick="addRow()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold shadow-lg transform hover:scale-105 transition-all duration-200 flex items-center gap-2"> <span class="text-lg">âž•</span> <span>SatÄ±r Ekle</span> </button> <button onclick="removeRow()" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-semibold shadow-lg transform hover:scale-105 transition-all duration-200 flex items-center gap-2"> <span class="text-lg">ðŸ—‘</span> <span>SatÄ±r Sil</span> </button> <button onclick="clearForm()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-semibold shadow-lg transform hover:scale-105 transition-all duration-200 flex items-center gap-2"> <span class="text-lg">ðŸ§¹</span> <span>Temizle</span> </button> <button onclick="printForm()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold shadow-lg transform hover:scale-105 transition-all duration-200 flex items-center gap-2"> <span class="text-lg">ðŸ–¨</span> <span>YazdÄ±r</span> </button>
   </div><!-- Ä°mza AlanlarÄ± -->
   <div class="mt-12">
    <div class="grid grid-cols-3 gap-8 text-center">
     <div>
      <div class="signature-line mb-2" style="border-bottom: 2px solid #000; height: 50px; position: relative;">
       <div style="position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%); font-size: 18px; color: #000;">
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       </div>
      </div>
      <p class="font-bold text-sm mt-3" id="signature-1-name">OÄŸuzhan KarslÄ±</p>
      <p class="text-xs text-gray-500" id="signature-1-title">SATINALMA VE LOJÄ°STÄ°K MÃœDÃœRÃœ</p>
     </div>
     <div>
      <div class="signature-line mb-2" style="border-bottom: 2px solid #000; height: 50px; position: relative;">
       <div style="position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%); font-size: 18px; color: #000;">
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       </div>
      </div>
      <p class="font-bold text-sm mt-3" id="signature-2-name">Osman TalaÅŸ</p>
      <p class="text-xs text-gray-500" id="signature-2-title">GENEL MÃœDÃœR</p>
     </div>
     <div>
      <div class="signature-line mb-2" style="border-bottom: 2px solid #000; height: 50px; position: relative;">
       <div style="position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%); font-size: 18px; color: #000;">
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       </div>
      </div>
      <p class="font-bold text-sm mt-3" id="signature-3-name">Mutlu DoÄŸan</p>
      <p class="text-xs text-gray-500" id="signature-3-title">ONAY</p>
     </div>
    </div>
   </div><!-- PDF Ä°ndir Butonu -->
   <div class="text-center mt-8 no-print"><button onclick="generatePDF()" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-bold text-lg shadow-lg transform hover:scale-105 transition-all duration-200"> ðŸ“„ PDF olarak Ä°ndir </button>
    <p class="text-xs text-gray-500 mt-3 italic">*Bu belge elektronik ortamda hazÄ±rlanmÄ±ÅŸtÄ±r.</p>
   </div>
  </div>
  <script>
        let rowCount = 0;

        // VarsayÄ±lan konfigÃ¼rasyon
        const defaultConfig = {
            form_title: "SÄ°PARÄ°Åž ONAY FORMU (SOF)",
            company_info: "RF100, SOMTECH RU, FABRÄ°KA MÃœDÃœRLÃœÄžÃœ",
            signature_1_name: "OÄŸuzhan KarslÄ±",
            signature_1_title: "SATINALMA VE LOJÄ°STÄ°K MÃœDÃœRÃœ",
            signature_2_name: "Osman TalaÅŸ",
            signature_2_title: "GENEL MÃœDÃœR",
            signature_3_name: "Mutlu DoÄŸan",
            signature_3_title: "ONAY"
        };

        // Render fonksiyonu
        async function render(config) {
            document.getElementById('form-title').textContent = config.form_title || defaultConfig.form_title;
            document.getElementById('company-info').textContent = config.company_info || defaultConfig.company_info;
            document.getElementById('signature-1-name').textContent = config.signature_1_name || defaultConfig.signature_1_name;
            document.getElementById('signature-1-title').textContent = config.signature_1_title || defaultConfig.signature_1_title;
            document.getElementById('signature-2-name').textContent = config.signature_2_name || defaultConfig.signature_2_name;
            document.getElementById('signature-2-title').textContent = config.signature_2_title || defaultConfig.signature_2_title;
            document.getElementById('signature-3-name').textContent = config.signature_3_name || defaultConfig.signature_3_name;
            document.getElementById('signature-3-title').textContent = config.signature_3_title || defaultConfig.signature_3_title;
        }

        // Capabilities
        function mapToCapabilities(config) {
            return {
                recolorables: [],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        // Edit panel values
        function mapToEditPanelValues(config) {
            return new Map([
                ["form_title", config.form_title || defaultConfig.form_title],
                ["company_info", config.company_info || defaultConfig.company_info],
                ["signature_1_name", config.signature_1_name || defaultConfig.signature_1_name],
                ["signature_1_title", config.signature_1_title || defaultConfig.signature_1_title],
                ["signature_2_name", config.signature_2_name || defaultConfig.signature_2_name],
                ["signature_2_title", config.signature_2_title || defaultConfig.signature_2_title],
                ["signature_3_name", config.signature_3_name || defaultConfig.signature_3_name],
                ["signature_3_title", config.signature_3_title || defaultConfig.signature_3_title]
            ]);
        }

        // SDK baÅŸlatma
        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                render,
                mapToCapabilities,
                mapToEditPanelValues
            });
        }

        // BugÃ¼nÃ¼n tarihini gÃ¶ster
        function setCurrentDate() {
            const today = new Date();
            const day = String(today.getDate()).padStart(2, '0');
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const year = today.getFullYear();
            document.getElementById('current-date').textContent = `${day}.${month}.${year}`;
        }

        // SatÄ±r ekleme fonksiyonu - Yeni satÄ±r ekler ve otomatik hesaplama baÄŸlar
        function addRow() {
            rowCount++;
            const tbody = document.getElementById('table-body');
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-50 border-b border-gray-300';
            row.innerHTML = `
                <td class="table-cell font-semibold">${rowCount}</td>
                <td class="table-cell">
                    <input type="date" class="w-full text-xs border-0 bg-transparent focus:bg-white focus:border focus:border-blue-300 rounded px-1 py-1">
                </td>
                <td class="table-cell">
                    <input type="text" class="w-full text-xs border-0 bg-transparent focus:bg-white focus:border focus:border-blue-300 rounded px-1 py-1" placeholder="Malzeme adÄ±">
                </td>
                <td class="table-cell">
                    <input type="text" class="w-full text-xs border-0 bg-transparent focus:bg-white focus:border focus:border-blue-300 rounded px-1 py-1" placeholder="Marka/Model">
                </td>
                <td class="table-cell">
                    <input type="text" class="w-full text-xs border-0 bg-transparent focus:bg-white focus:border focus:border-blue-300 rounded px-1 py-1" placeholder="Proje kodu">
                </td>
                <td class="table-cell">
                    <input type="text" class="w-full text-xs border-0 bg-transparent focus:bg-white focus:border focus:border-blue-300 rounded px-1 py-1" placeholder="Adet/Kg/MÂ²">
                </td>
                <td class="table-cell">
                    <input type="number" class="w-full text-xs border-0 bg-transparent focus:bg-white focus:border focus:border-blue-300 rounded px-1 py-1 talep-miktari" placeholder="0" min="0" step="0.01" oninput="calculateRowTotal(this)">
                </td>
                <td class="table-cell">
                    <input type="number" class="w-full text-xs border-0 bg-transparent focus:bg-white focus:border focus:border-blue-300 rounded px-1 py-1 siparis-miktari" placeholder="0" min="0" step="0.01" oninput="calculateRowTotal(this)">
                </td>
                <td class="table-cell">
                    <input type="number" class="w-full text-xs border-0 bg-transparent focus:bg-white focus:border focus:border-blue-300 rounded px-1 py-1 birim-fiyat" placeholder="0.00" min="0" step="0.01" oninput="calculateRowTotal(this)">
                </td>
                <td class="table-cell toplam-fiyat font-bold text-blue-800 bg-blue-50">â‚½ 0.00</td>
            `;
            tbody.appendChild(row);
            
            // Yeni eklenen satÄ±rÄ±n inputlarÄ±na focus event ekle
            const inputs = row.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.classList.add('bg-yellow-100');
                });
                input.addEventListener('blur', function() {
                    this.classList.remove('bg-yellow-100');
                });
            });
        }

        // SatÄ±r silme fonksiyonu - Son satÄ±rÄ± siler ve toplamlarÄ± gÃ¼nceller
        function removeRow() {
            const tbody = document.getElementById('table-body');
            if (tbody.children.length > 0) {
                // Silme onayÄ±
                const confirmDelete = confirm('Son satÄ±rÄ± silmek istediÄŸinizden emin misiniz?');
                if (confirmDelete) {
                    tbody.removeChild(tbody.lastElementChild);
                    rowCount = Math.max(0, rowCount - 1);
                    updateRowNumbers();
                    calculateGrandTotal();
                    
                    // BaÅŸarÄ± mesajÄ± gÃ¶ster
                    showMessage('SatÄ±r baÅŸarÄ±yla silindi!', 'success');
                }
            } else {
                showMessage('Silinecek satÄ±r bulunamadÄ±!', 'warning');
            }
        }

        // SatÄ±r numaralarÄ±nÄ± gÃ¼ncelleme fonksiyonu
        function updateRowNumbers() {
            const tbody = document.getElementById('table-body');
            Array.from(tbody.children).forEach((row, index) => {
                row.children[0].textContent = index + 1;
            });
            rowCount = tbody.children.length;
        }

        // SatÄ±r toplamÄ±nÄ± hesaplama fonksiyonu - TALEP MÄ°KTARI Ã— BÄ°RÄ°M FÄ°YAT
        function calculateRowTotal(input) {
            const row = input.closest('tr');
            const talepMiktari = parseFloat(row.querySelector('.talep-miktari').value) || 0;
            const birimFiyat = parseFloat(row.querySelector('.birim-fiyat').value) || 0;
            
            // TOPLAM FÄ°YAT = TALEP MÄ°KTARI Ã— BÄ°RÄ°M FÄ°YAT
            const toplam = talepMiktari * birimFiyat;
            
            // ToplamÄ± gÃ¼ncelle ve para birimi ekle
            const toplamCell = row.querySelector('.toplam-fiyat');
            toplamCell.textContent = `â‚½ ${toplam.toLocaleString('tr-TR', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            
            // Toplam sÄ±fÄ±rdan bÃ¼yÃ¼kse yeÅŸil, deÄŸilse mavi yap
            if (toplam > 0) {
                toplamCell.className = 'table-cell toplam-fiyat font-bold text-green-800 bg-green-50';
            } else {
                toplamCell.className = 'table-cell toplam-fiyat font-bold text-blue-800 bg-blue-50';
            }
            
            // Genel toplamÄ± gÃ¼ncelle
            calculateGrandTotal();
        }

        // Genel toplam hesaplama fonksiyonu
        function calculateGrandTotal() {
            const toplamCells = document.querySelectorAll('.toplam-fiyat');
            let genelToplam = 0;
            
            toplamCells.forEach(cell => {
                // â‚½ iÅŸaretini ve formatlamayÄ± temizle
                const value = cell.textContent.replace('â‚½', '').replace(/\./g, '').replace(',', '.').trim();
                genelToplam += parseFloat(value) || 0;
            });
            
            // Genel toplamÄ± gÃ¼ncelle
            const genelToplamCell = document.getElementById('grand-total');
            genelToplamCell.textContent = `â‚½ ${genelToplam.toLocaleString('tr-TR', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            
            // Genel toplam animasyonu
            genelToplamCell.classList.add('animate-pulse');
            setTimeout(() => {
                genelToplamCell.classList.remove('animate-pulse');
            }, 500);
        }

        // Formu temizleme fonksiyonu
        function clearForm() {
            const confirmClear = confirm('TÃ¼m form verilerini temizlemek istediÄŸinizden emin misiniz?\nBu iÅŸlem geri alÄ±namaz!');
            if (confirmClear) {
                const tbody = document.getElementById('table-body');
                tbody.innerHTML = '';
                rowCount = 0;
                calculateGrandTotal();
                
                // Temizleme sonrasÄ± 3 boÅŸ satÄ±r ekle
                for (let i = 0; i < 3; i++) {
                    addRow();
                }
                
                showMessage('Form baÅŸarÄ±yla temizlendi!', 'success');
            }
        }

        // Mesaj gÃ¶sterme fonksiyonu
        function showMessage(message, type = 'info') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `fixed top-4 right-4 z-50 px-4 py-2 rounded-lg text-white font-semibold shadow-lg transform transition-all duration-300 ${
                type === 'success' ? 'bg-green-600' : 
                type === 'warning' ? 'bg-yellow-600' : 
                type === 'error' ? 'bg-red-600' : 'bg-blue-600'
            }`;
            messageDiv.textContent = message;
            
            document.body.appendChild(messageDiv);
            
            // Animasyon
            setTimeout(() => messageDiv.classList.add('translate-x-0'), 100);
            setTimeout(() => {
                messageDiv.classList.add('translate-x-full', 'opacity-0');
                setTimeout(() => document.body.removeChild(messageDiv), 300);
            }, 3000);
        }

        // PDF indirme fonksiyonu
        const { jsPDF } = window.jspdf;
        async function generatePDF() {
            showMessage('PDF hazÄ±rlanÄ±yor, lÃ¼tfen bekleyin...', 'info');
            
            const pdf = new jsPDF("p", "mm", "a4");

            // VarsayÄ±lan logo
            const logoURL = "https://www.somtech.com.tr/wp-content/uploads/2024/01/logo.png";
            const img = new Image();
            img.crossOrigin = "Anonymous";
            img.src = logoURL;

            img.onload = function () {
                // Ãœst baÅŸlÄ±k
                pdf.addImage(img, "PNG", 15, 10, 35, 15);
                pdf.setFontSize(14);
                pdf.setTextColor(36, 89, 160);
                pdf.text("SOMTECH RU", 60, 20);
                pdf.setTextColor(207, 46, 38);
                pdf.setFontSize(11);
                pdf.text("SÄ°PARÄ°Åž ONAY FORMU (SOF)", 60, 27);

                // Tarih
                const date = new Date().toLocaleDateString("tr-TR");
                pdf.setFontSize(10);
                pdf.setTextColor(0, 0, 0);
                pdf.text(`Tarih: ${date}`, 190, 20, { align: "right" });

                // Tabloyu PDF'e dÃ¶nÃ¼ÅŸtÃ¼r
                const table = document.querySelector("table");
                pdf.html(table, {
                    callback: function (pdf) {
                        pdf.setFontSize(9);
                        pdf.text("Bu belge elektronik ortamda hazÄ±rlanmÄ±ÅŸtÄ±r.", 105, 290, { align: "center" });
                        pdf.save(`SOMTECH_SOF_${date.replace(/\./g, '_')}.pdf`);
                        showMessage('PDF baÅŸarÄ±yla indirildi!', 'success');
                    },
                    x: 10,
                    y: 40,
                    html2canvas: { scale: 0.6 },
                });
            };

            img.onerror = function () {
                // Logo yÃ¼klenemezse logosuz devam et
                pdf.setFontSize(14);
                pdf.setTextColor(36, 89, 160);
                pdf.text("SOMTECH RU", 15, 20);
                pdf.setTextColor(207, 46, 38);
                pdf.setFontSize(11);
                pdf.text("SÄ°PARÄ°Åž ONAY FORMU (SOF)", 15, 27);

                // Tarih
                const date = new Date().toLocaleDateString("tr-TR");
                pdf.setFontSize(10);
                pdf.setTextColor(0, 0, 0);
                pdf.text(`Tarih: ${date}`, 190, 20, { align: "right" });

                // Tabloyu PDF'e dÃ¶nÃ¼ÅŸtÃ¼r
                const table = document.querySelector("table");
                pdf.html(table, {
                    callback: function (pdf) {
                        pdf.setFontSize(9);
                        pdf.text("Bu belge elektronik ortamda hazÄ±rlanmÄ±ÅŸtÄ±r.", 105, 290, { align: "center" });
                        pdf.save(`SOMTECH_SOF_${date.replace(/\./g, '_')}.pdf`);
                        showMessage('PDF baÅŸarÄ±yla indirildi!', 'success');
                    },
                    x: 10,
                    y: 40,
                    html2canvas: { scale: 0.6 },
                });
            };
        }



        // YazdÄ±rma fonksiyonu
        function printForm() {
            showMessage('YazdÄ±rma hazÄ±rlanÄ±yor...', 'info');
            
            // YazdÄ±rma Ã¶ncesi stil ayarlarÄ±
            const originalTitle = document.title;
            document.title = 'SomTech SipariÅŸ Onay Formu';
            
            // YazdÄ±r
            window.print();
            
            // BaÅŸlÄ±ÄŸÄ± geri yÃ¼kle
            document.title = originalTitle;
            
            showMessage('YazdÄ±rma penceresi aÃ§Ä±ldÄ±!', 'success');
        }

        // Klavye kÄ±sayollarÄ±
        document.addEventListener('keydown', function(e) {
            // Ctrl+P - YazdÄ±r
            if (e.ctrlKey && e.key === 'p') {
                e.preventDefault();
                printForm();
            }
            
            // Ctrl+S - PDF Ä°ndir
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                generatePDF();
            }
            
            // Ctrl+N - Yeni SatÄ±r
            if (e.ctrlKey && e.key === 'n') {
                e.preventDefault();
                addRow();
            }
            
            // Delete - SatÄ±r Sil (sadece tablo iÃ§indeyken)
            if (e.key === 'Delete' && e.target.closest('table')) {
                removeRow();
            }
        });

        // Otomatik kaydetme (localStorage)
        function autoSave() {
            const formData = {
                rows: [],
                timestamp: new Date().toISOString()
            };
            
            const tbody = document.getElementById('table-body');
            Array.from(tbody.children).forEach(row => {
                const inputs = row.querySelectorAll('input');
                const rowData = {
                    date: inputs[0].value,
                    material: inputs[1].value,
                    detail1: inputs[2].value,
                    detail2: inputs[3].value,
                    unit: inputs[4].value,
                    requestQty: inputs[5].value,
                    orderQty: inputs[6].value,
                    unitPrice: inputs[7].value
                };
                formData.rows.push(rowData);
            });
            
            localStorage.setItem('somtech_form_data', JSON.stringify(formData));
        }

        // Otomatik yÃ¼kleme
        function autoLoad() {
            const savedData = localStorage.getItem('somtech_form_data');
            if (savedData) {
                try {
                    const formData = JSON.parse(savedData);
                    const tbody = document.getElementById('table-body');
                    tbody.innerHTML = '';
                    rowCount = 0;
                    
                    formData.rows.forEach(rowData => {
                        addRow();
                        const row = tbody.lastElementChild;
                        const inputs = row.querySelectorAll('input');
                        
                        inputs[0].value = rowData.date || '';
                        inputs[1].value = rowData.material || '';
                        inputs[2].value = rowData.detail1 || '';
                        inputs[3].value = rowData.detail2 || '';
                        inputs[4].value = rowData.unit || '';
                        inputs[5].value = rowData.requestQty || '';
                        inputs[6].value = rowData.orderQty || '';
                        inputs[7].value = rowData.unitPrice || '';
                        
                        // ToplamlarÄ± hesapla
                        if (inputs[5].value && inputs[7].value) {
                            calculateRowTotal(inputs[5]);
                        }
                    });
                    
                    showMessage('Ã–nceki veriler yÃ¼klendi!', 'info');
                } catch (error) {
                    console.error('Veri yÃ¼kleme hatasÄ±:', error);
                }
            }
        }

        // Form deÄŸiÅŸikliklerini dinle ve otomatik kaydet
        document.addEventListener('input', function(e) {
            if (e.target.closest('.print-page')) {
                clearTimeout(window.autoSaveTimeout);
                window.autoSaveTimeout = setTimeout(autoSave, 2000); // 2 saniye sonra kaydet
            }
        });

        // Sayfa yÃ¼klendiÄŸinde
        document.addEventListener('DOMContentLoaded', function() {
            setCurrentDate();
            
            // Ã–nceki verileri yÃ¼kle
            autoLoad();
            
            // EÄŸer veri yoksa 3 boÅŸ satÄ±r ekle
            if (document.getElementById('table-body').children.length === 0) {
                for (let i = 0; i < 3; i++) {
                    addRow();
                }
            }
            
            // HoÅŸ geldin mesajÄ±
            setTimeout(() => {
                showMessage('SomTech SipariÅŸ Onay Formu hazÄ±r! Klavye kÄ±sayollarÄ±: Ctrl+P (YazdÄ±r), Ctrl+S (PDF), Ctrl+N (Yeni SatÄ±r)', 'info');
            }, 1000);
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98fe25d8232235e7',t:'MTc2MDY4NjgyNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
