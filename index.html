<!doctype html>
<html lang="tr">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SomTech RU - SipariÅŸ Onay Formu</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://html2canvas.js.org/dist/html2canvas.min.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
            font-family: 'Calibri', 'Arial', sans-serif;
        }
        
        @media print {
            .no-print { display: none !important; }
            body { 
                background: white !important; 
                margin: 0;
                padding: 0;
            }
            .print-page { 
                width: 210mm; 
                min-height: 297mm; 
                margin: 0; 
                padding: 18mm 14mm;
                box-shadow: none;
                border: 1px solid #e5e7eb;
                background: white;
            }
            .table-cell input {
                border: none !important;
                background: transparent !important;
                color: black !important;
            }
            .signature-line {
                border-bottom: 2px solid #000 !important;
                background: transparent !important;
            }
        }
        
        .print-page {
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
            margin: 20px auto;
            max-width: 210mm;
            min-height: 297mm;
            padding: 18mm 14mm;
        }
        
        /* Responsive tasarÄ±m */
        @media (max-width: 1024px) {
            .print-page {
                margin: 10px;
                padding: 15mm;
                max-width: 100%;
            }
            
            .table-cell {
                padding: 4px 2px;
                font-size: 10px;
            }
            
            input[type="text"], input[type="number"], input[type="date"] {
                font-size: 10px;
                padding: 2px 4px;
            }
        }
        
        @media (max-width: 768px) {
            .print-page {
                padding: 10mm;
            }
            
            .grid-cols-3 {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .table-cell {
                padding: 3px 1px;
                font-size: 9px;
            }
            
            .overflow-x-auto {
                overflow-x: scroll;
            }
            
            table {
                min-width: 800px;
            }
        }
        
        @media (max-width: 480px) {
            .flex {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .flex-1 {
                text-align: center;
            }
            
            .text-xl {
                font-size: 1rem;
            }
            
            .text-lg {
                font-size: 0.9rem;
            }
        }
        
        input[type="text"], input[type="number"], input[type="date"] {
            border: 1px solid #d1d5db;
            padding: 4px 8px;
            font-size: 12px;
            width: 100%;
        }
        
        .table-cell {
            border: 1px solid #374151;
            padding: 8px 4px;
            text-align: center;
            vertical-align: middle;
        }
        
        .signature-line {
            border-bottom: 2px solid #000;
            height: 40px;
            margin-bottom: 5px;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="bg-gray-100 min-h-full">
  <div class="print-page"><!-- Ãœst BÃ¶lÃ¼m -->
   <div class="mb-8"><!-- Logo ve Tarih -->
    <div class="flex justify-between items-start mb-6">
     <div class="flex-shrink-0"><img src="https://www.somtech.com.tr/wp-content/uploads/2024/01/logo.png" alt="SomTech Logo" class="h-16" style="width: 120px; height: auto;" onerror="this.style.display='none';">
     </div>
     <div class="flex-shrink-0 text-right">
      <div class="bg-gray-100 px-4 py-2 rounded-lg border"><span class="text-sm font-semibold text-gray-700">ðŸ“… Tarih: </span> <span id="current-date" class="text-sm font-bold"></span>
      </div>
     </div>
    </div><!-- BaÅŸlÄ±k - OrtalanmÄ±ÅŸ -->
    <div class="text-center mb-6">
     <h1 id="form-title" class="text-2xl font-bold text-gray-800 mb-3">SÄ°PARÄ°Åž ONAY FORMU (SOF)</h1>
     <div class="w-full h-0.5 mb-4" style="background-color: #cf2e26;"></div>
     <p id="company-info" class="text-base font-semibold text-gray-600">RF100, SOMTECH RU, FABRÄ°KA MÃœDÃœRLÃœÄžÃœ</p>
    </div>
   </div><!-- Tablo -->
   <div class="overflow-x-auto mb-6">
    <table class="w-full border-collapse border-2 border-gray-800 text-xs">
     <thead>
      <tr class="bg-blue-800 text-white">
       <th class="table-cell w-12">SIRA NO</th>
       <th class="table-cell w-24">Ä°STENEN TESLÄ°M TARÄ°HÄ°</th>
       <th class="table-cell w-32">TALEP EDÄ°LEN MALZEME</th>
       <th class="table-cell w-28">DETAY 1 (MARKA, MODEL VB)</th>
       <th class="table-cell w-28">DETAY 2 (PROJE, STANDART VB KODLAR)</th>
       <th class="table-cell w-16">BÄ°RÄ°M</th>
       <th class="table-cell w-20">TALEP MÄ°KTARI</th>
       <th class="table-cell w-20">SÄ°PARÄ°Åž MÄ°KTARI</th>
       <th class="table-cell w-24">BÄ°RÄ°M FÄ°YAT (â‚½ RUB)</th>
       <th class="table-cell w-24">TOPLAM FÄ°YAT (â‚½ RUB)</th>
      </tr>
     </thead>
     <tbody id="table-body"><!-- SatÄ±rlar buraya eklenecek -->
     </tbody>
     <tfoot>
      <tr class="bg-gray-200">
       <td colspan="9" class="table-cell text-right font-bold">GENEL TOPLAM (â‚½ RUB):</td>
       <td class="table-cell font-bold text-lg" id="grand-total">0.00</td>
      </tr>
     </tfoot>
    </table>
   </div><!-- Butonlar -->
   <div class="flex flex-wrap gap-3 mb-6 no-print justify-center md:justify-start"><button onclick="addRow()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold shadow-lg transform hover:scale-105 transition-all duration-200 flex items-center gap-2"> <span class="text-lg">âž•</span> <span>SatÄ±r Ekle</span> </button> <button onclick="removeRow()" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-semibold shadow-lg transform hover:scale-105 transition-all duration-200 flex items-center gap-2"> <span class="text-lg">ðŸ—‘</span> <span>SatÄ±r Sil</span> </button> <button onclick="clearForm()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-semibold shadow-lg transform hover:scale-105 transition-all duration-200 flex items-center gap-2"> <span class="text-lg">ðŸ§¹</span> <span>Temizle</span> </button> <button onclick="printForm()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold shadow-lg transform hover:scale-105 transition-all duration-200 flex items-center gap-2"> <span class="text-lg">ðŸ–¨</span> <span>YazdÄ±r</span> </button>
   </div><!-- Ä°mza AlanlarÄ± -->
   <div class="mt-12">
    <div class="grid grid-cols-3 gap-8 text-center">
     <div>
      <div class="signature-line mb-2" style="border-bottom: 2px solid #000; height: 50px; position: relative;">
       <div style="position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%); font-size: 18px; color: #000;">
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       </div>
      </div>
      <p class="font-bold text-sm mt-3" id="signature-1-name">OÄŸuzhan KarslÄ±</p>
      <p class="text-xs text-gray-500" id="signature-1-title">SATINALMA VE LOJÄ°STÄ°K MÃœDÃœRÃœ</p>
     </div>
     <div>
      <div class="signature-line mb-2" style="border-bottom: 2px solid #000; height: 50px; position: relative;">
       <div style="position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%); font-size: 18px; color: #000;">
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       </div>
      </div>
      <p class="font-bold text-sm mt-3" id="signature-2-name">Osman TalaÅŸ</p>
      <p class="text-xs text-gray-500" id="signature-2-title">GENEL MÃœDÃœR</p>
     </div>
     <div>
      <div class="signature-line mb-2" style="border-bottom: 2px solid #000; height: 50px; position: relative;">
       <div style="position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%); font-size: 18px; color: #000;">
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       </div>
      </div>
      <p class="font-bold text-sm mt-3" id="signature-3-name">Mutlu DoÄŸan</p>
      <p class="text-xs text-gray-500" id="signature-3-title">ONAY</p>
     </div>
    </div>
   </div><!-- PDF Ä°ndir Butonu -->
   <div class="text-center mt-8 no-print"><button onclick="downloadPDF()" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-bold text-lg shadow-lg transform hover:scale-105 transition-all duration-200"> ðŸ“„ PDF olarak Ä°ndir </button>
    <p class="text-xs text-gray-500 mt-3 italic">*Bu belge elektronik ortamda hazÄ±rlanmÄ±ÅŸtÄ±r.</p>
   </div>
  </div>
  <script>
        let rowCount = 0;

        // VarsayÄ±lan konfigÃ¼rasyon
        const defaultConfig = {
            form_title: "SÄ°PARÄ°Åž ONAY FORMU (SOF)",
            company_info: "RF100, SOMTECH RU, FABRÄ°KA MÃœDÃœRLÃœÄžÃœ",
            signature_1_name: "OÄŸuzhan KarslÄ±",
            signature_1_title: "SATINALMA VE LOJÄ°STÄ°K MÃœDÃœRÃœ",
            signature_2_name: "Osman TalaÅŸ",
            signature_2_title: "GENEL MÃœDÃœR",
            signature_3_name: "Mutlu DoÄŸan",
            signature_3_title: "ONAY"
        };

        // Render fonksiyonu
        async function render(config) {
            document.getElementById('form-title').textContent = config.form_title || defaultConfig.form_title;
            document.getElementById('company-info').textContent = config.company_info || defaultConfig.company_info;
            document.getElementById('signature-1-name').textContent = config.signature_1_name || defaultConfig.signature_1_name;
            document.getElementById('signature-1-title').textContent = config.signature_1_title || defaultConfig.signature_1_title;
            document.getElementById('signature-2-name').textContent = config.signature_2_name || defaultConfig.signature_2_name;
            document.getElementById('signature-2-title').textContent = config.signature_2_title || defaultConfig.signature_2_title;
            document.getElementById('signature-3-name').textContent = config.signature_3_name || defaultConfig.signature_3_name;
            document.getElementById('signature-3-title').textContent = config.signature_3_title || defaultConfig.signature_3_title;
        }

        // Capabilities
        function mapToCapabilities(config) {
            return {
                recolorables: [],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        // Edit panel values
        function mapToEditPanelValues(config) {
            return new Map([
                ["form_title", config.form_title || defaultConfig.form_title],
                ["company_info", config.company_info || defaultConfig.company_info],
                ["signature_1_name", config.signature_1_name || defaultConfig.signature_1_name],
                ["signature_1_title", config.signature_1_title || defaultConfig.signature_1_title],
                ["signature_2_name", config.signature_2_name || defaultConfig.signature_2_name],
                ["signature_2_title", config.signature_2_title || defaultConfig.signature_2_title],
                ["signature_3_name", config.signature_3_name || defaultConfig.signature_3_name],
                ["signature_3_title", config.signature_3_title || defaultConfig.signature_3_title]
            ]);
        }

        // SDK baÅŸlatma
        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                render,
                mapToCapabilities,
                mapToEditPanelValues
            });
        }

        // BugÃ¼nÃ¼n tarihini gÃ¶ster
        function setCurrentDate() {
            const today = new Date();
            const day = String(today.getDate()).padStart(2, '0');
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const year = today.getFullYear();
            document.getElementById('current-date').textContent = `${day}.${month}.${year}`;
        }

        // SatÄ±r ekleme fonksiyonu - Yeni satÄ±r ekler ve otomatik hesaplama baÄŸlar
        function addRow() {
            rowCount++;
            const tbody = document.getElementById('table-body');
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-50 border-b border-gray-300';
            row.innerHTML = `
                <td class="table-cell font-semibold">${rowCount}</td>
                <td class="table-cell">
                    <input type="date" class="w-full text-xs border-0 bg-transparent focus:bg-white focus:border focus:border-blue-300 rounded px-1 py-1">
                </td>
                <td class="table-cell">
                    <input type="text" class="w-full text-xs border-0 bg-transparent focus:bg-white focus:border focus:border-blue-300 rounded px-1 py-1" placeholder="Malzeme adÄ±">
                </td>
                <td class="table-cell">
                    <input type="text" class="w-full text-xs border-0 bg-transparent focus:bg-white focus:border focus:border-blue-300 rounded px-1 py-1" placeholder="Marka/Model">
                </td>
                <td class="table-cell">
                    <input type="text" class="w-full text-xs border-0 bg-transparent focus:bg-white focus:border focus:border-blue-300 rounded px-1 py-1" placeholder="Proje kodu">
                </td>
                <td class="table-cell">
                    <input type="text" class="w-full text-xs border-0 bg-transparent focus:bg-white focus:border focus:border-blue-300 rounded px-1 py-1" placeholder="Adet/Kg/MÂ²">
                </td>
                <td class="table-cell">
                    <input type="number" class="w-full text-xs border-0 bg-transparent focus:bg-white focus:border focus:border-blue-300 rounded px-1 py-1 talep-miktari" placeholder="0" min="0" step="0.01" oninput="calculateRowTotal(this)">
                </td>
                <td class="table-cell">
                    <input type="number" class="w-full text-xs border-0 bg-transparent focus:bg-white focus:border focus:border-blue-300 rounded px-1 py-1 siparis-miktari" placeholder="0" min="0" step="0.01" oninput="calculateRowTotal(this)">
                </td>
                <td class="table-cell">
                    <input type="number" class="w-full text-xs border-0 bg-transparent focus:bg-white focus:border focus:border-blue-300 rounded px-1 py-1 birim-fiyat" placeholder="0.00" min="0" step="0.01" oninput="calculateRowTotal(this)">
                </td>
                <td class="table-cell toplam-fiyat font-bold text-blue-800 bg-blue-50">â‚½ 0.00</td>
            `;
            tbody.appendChild(row);
            
            // Yeni eklenen satÄ±rÄ±n inputlarÄ±na focus event ekle
            const inputs = row.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.classList.add('bg-yellow-100');
                });
                input.addEventListener('blur', function() {
                    this.classList.remove('bg-yellow-100');
                });
            });
        }

        // SatÄ±r silme fonksiyonu - Son satÄ±rÄ± siler ve toplamlarÄ± gÃ¼nceller
        function removeRow() {
            const tbody = document.getElementById('table-body');
            if (tbody.children.length > 0) {
                // Silme onayÄ±
                const confirmDelete = confirm('Son satÄ±rÄ± silmek istediÄŸinizden emin misiniz?');
                if (confirmDelete) {
                    tbody.removeChild(tbody.lastElementChild);
                    rowCount = Math.max(0, rowCount - 1);
                    updateRowNumbers();
                    calculateGrandTotal();
                    
                    // BaÅŸarÄ± mesajÄ± gÃ¶ster
                    showMessage('SatÄ±r baÅŸarÄ±yla silindi!', 'success');
                }
            } else {
                showMessage('Silinecek satÄ±r bulunamadÄ±!', 'warning');
            }
        }

        // SatÄ±r numaralarÄ±nÄ± gÃ¼ncelleme fonksiyonu
        function updateRowNumbers() {
            const tbody = document.getElementById('table-body');
            Array.from(tbody.children).forEach((row, index) => {
                row.children[0].textContent = index + 1;
            });
            rowCount = tbody.children.length;
        }

        // SatÄ±r toplamÄ±nÄ± hesaplama fonksiyonu - TALEP MÄ°KTARI Ã— BÄ°RÄ°M FÄ°YAT
        function calculateRowTotal(input) {
            const row = input.closest('tr');
            const talepMiktari = parseFloat(row.querySelector('.talep-miktari').value) || 0;
            const birimFiyat = parseFloat(row.querySelector('.birim-fiyat').value) || 0;
            
            // TOPLAM FÄ°YAT = TALEP MÄ°KTARI Ã— BÄ°RÄ°M FÄ°YAT
            const toplam = talepMiktari * birimFiyat;
            
            // ToplamÄ± gÃ¼ncelle ve para birimi ekle
            const toplamCell = row.querySelector('.toplam-fiyat');
            toplamCell.textContent = `â‚½ ${toplam.toLocaleString('tr-TR', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            
            // Toplam sÄ±fÄ±rdan bÃ¼yÃ¼kse yeÅŸil, deÄŸilse mavi yap
            if (toplam > 0) {
                toplamCell.className = 'table-cell toplam-fiyat font-bold text-green-800 bg-green-50';
            } else {
                toplamCell.className = 'table-cell toplam-fiyat font-bold text-blue-800 bg-blue-50';
            }
            
            // Genel toplamÄ± gÃ¼ncelle
            calculateGrandTotal();
        }

        // Genel toplam hesaplama fonksiyonu
        function calculateGrandTotal() {
            const toplamCells = document.querySelectorAll('.toplam-fiyat');
            let genelToplam = 0;
            
            toplamCells.forEach(cell => {
                // â‚½ iÅŸaretini ve formatlamayÄ± temizle
                const value = cell.textContent.replace('â‚½', '').replace(/\./g, '').replace(',', '.').trim();
                genelToplam += parseFloat(value) || 0;
            });
            
            // Genel toplamÄ± gÃ¼ncelle
            const genelToplamCell = document.getElementById('grand-total');
            genelToplamCell.textContent = `â‚½ ${genelToplam.toLocaleString('tr-TR', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            
            // Genel toplam animasyonu
            genelToplamCell.classList.add('animate-pulse');
            setTimeout(() => {
                genelToplamCell.classList.remove('animate-pulse');
            }, 500);
        }

        // Formu temizleme fonksiyonu
        function clearForm() {
            const confirmClear = confirm('TÃ¼m form verilerini temizlemek istediÄŸinizden emin misiniz?\nBu iÅŸlem geri alÄ±namaz!');
            if (confirmClear) {
                const tbody = document.getElementById('table-body');
                tbody.innerHTML = '';
                rowCount = 0;
                calculateGrandTotal();
                
                // Temizleme sonrasÄ± 3 boÅŸ satÄ±r ekle
                for (let i = 0; i < 3; i++) {
                    addRow();
                }
                
                showMessage('Form baÅŸarÄ±yla temizlendi!', 'success');
            }
        }

        // Mesaj gÃ¶sterme fonksiyonu
        function showMessage(message, type = 'info') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `fixed top-4 right-4 z-50 px-4 py-2 rounded-lg text-white font-semibold shadow-lg transform transition-all duration-300 ${
                type === 'success' ? 'bg-green-600' : 
                type === 'warning' ? 'bg-yellow-600' : 
                type === 'error' ? 'bg-red-600' : 'bg-blue-600'
            }`;
            messageDiv.textContent = message;
            
            document.body.appendChild(messageDiv);
            
            // Animasyon
            setTimeout(() => messageDiv.classList.add('translate-x-0'), 100);
            setTimeout(() => {
                messageDiv.classList.add('translate-x-full', 'opacity-0');
                setTimeout(() => document.body.removeChild(messageDiv), 300);
            }, 3000);
        }

        // PDF indirme fonksiyonu - GeliÅŸtirilmiÅŸ A4 uyumlu, profesyonel dÃ¼zen
        function downloadPDF() {
            showMessage('PDF hazÄ±rlanÄ±yor, lÃ¼tfen bekleyin...', 'info');
            
            // PDF iÃ§in Ã¶zel HTML oluÅŸtur
            const pdfContent = createPDFContent();
            
            // GeÃ§ici PDF container oluÅŸtur
            const pdfContainer = document.createElement('div');
            pdfContainer.innerHTML = pdfContent;
            pdfContainer.style.cssText = `
                position: absolute;
                top: -9999px;
                left: -9999px;
                width: 210mm;
                min-height: 297mm;
                background: white;
                padding: 18mm 14mm;
                font-family: 'Calibri', 'Arial', sans-serif;
                font-size: 12px;
                line-height: 1.4;
                color: #000;
            `;
            
            document.body.appendChild(pdfContainer);
            
            // HTML2Canvas ile yÃ¼ksek kaliteli gÃ¶rÃ¼ntÃ¼ al
            html2canvas(pdfContainer, {
                scale: 3, // YÃ¼ksek Ã§Ã¶zÃ¼nÃ¼rlÃ¼k iÃ§in
                useCORS: true,
                allowTaint: true,
                backgroundColor: '#ffffff',
                width: pdfContainer.scrollWidth,
                height: pdfContainer.scrollHeight,
                scrollX: 0,
                scrollY: 0,
                logging: false,
                imageTimeout: 15000,
                removeContainer: true
            }).then(canvas => {
                // GeÃ§ici container'Ä± temizle
                document.body.removeChild(pdfContainer);
                
                const imgData = canvas.toDataURL('image/png', 1.0);
                const { jsPDF } = window.jsPdf;
                
                // A4 boyutlarÄ± (mm)
                const pdf = new jsPDF('p', 'mm', 'a4');
                const pdfWidth = 210;
                const pdfHeight = 297;
                
                // GÃ¶rÃ¼ntÃ¼yÃ¼ A4'e tam sÄ±ÄŸacak ÅŸekilde boyutlandÄ±r
                const imgWidth = pdfWidth;
                const imgHeight = (canvas.height * pdfWidth) / canvas.width;
                
                // Tek sayfaya sÄ±ÄŸdÄ±r
                if (imgHeight <= pdfHeight) {
                    pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
                } else {
                    // Ã‡ok uzunsa Ã¶lÃ§ekle
                    const scaledHeight = pdfHeight;
                    const scaledWidth = (canvas.width * pdfHeight) / canvas.height;
                    const xOffset = Math.max(0, (pdfWidth - scaledWidth) / 2);
                    pdf.addImage(imgData, 'PNG', xOffset, 0, scaledWidth, scaledHeight);
                }
                
                // PDF metadata
                pdf.setProperties({
                    title: 'SomTech SipariÅŸ Onay Formu',
                    subject: 'SipariÅŸ Onay Belgesi',
                    author: 'SomTech RU',
                    creator: 'SomTech Form Sistemi'
                });
                
                // PDF'i indir
                const today = new Date();
                const dateStr = `${today.getDate().toString().padStart(2, '0')}.${(today.getMonth() + 1).toString().padStart(2, '0')}.${today.getFullYear()}`;
                pdf.save(`SomTech_Siparis_Onay_Formu_${dateStr}.pdf`);
                
                showMessage('PDF baÅŸarÄ±yla indirildi!', 'success');
            }).catch(error => {
                console.error('PDF oluÅŸturma hatasÄ±:', error);
                showMessage('PDF oluÅŸturulurken hata oluÅŸtu!', 'error');
                
                // Hata durumunda geÃ§ici container'Ä± temizle
                if (document.body.contains(pdfContainer)) {
                    document.body.removeChild(pdfContainer);
                }
            });
        }

        // PDF iÃ§in Ã¶zel HTML iÃ§eriÄŸi oluÅŸtur
        function createPDFContent() {
            // Mevcut form verilerini topla
            const formTitle = document.getElementById('form-title').textContent;
            const companyInfo = document.getElementById('company-info').textContent;
            const currentDate = document.getElementById('current-date').textContent;
            
            // Ä°mza bilgilerini al
            const signature1Name = document.getElementById('signature-1-name').textContent;
            const signature1Title = document.getElementById('signature-1-title').textContent;
            const signature2Name = document.getElementById('signature-2-name').textContent;
            const signature2Title = document.getElementById('signature-2-title').textContent;
            const signature3Name = document.getElementById('signature-3-name').textContent;
            const signature3Title = document.getElementById('signature-3-title').textContent;
            
            // Tablo verilerini topla
            const tbody = document.getElementById('table-body');
            let tableRows = '';
            let grandTotal = 0;
            
            Array.from(tbody.children).forEach((row, index) => {
                const inputs = row.querySelectorAll('input');
                const siraNo = index + 1;
                const teslimTarihi = inputs[0].value || '-';
                const malzeme = inputs[1].value || '-';
                const detay1 = inputs[2].value || '-';
                const detay2 = inputs[3].value || '-';
                const birim = inputs[4].value || '-';
                const talepMiktari = inputs[5].value || '0';
                const siparisMiktari = inputs[6].value || '0';
                const birimFiyat = inputs[7].value || '0';
                
                // Toplam hesapla
                const toplam = parseFloat(talepMiktari) * parseFloat(birimFiyat);
                grandTotal += toplam;
                
                tableRows += `
                    <tr style="border-bottom: 1px solid #374151;">
                        <td style="border: 1px solid #374151; padding: 8px 4px; text-align: center; font-weight: 600;">${siraNo}</td>
                        <td style="border: 1px solid #374151; padding: 8px 4px; text-align: center; font-size: 10px;">${teslimTarihi}</td>
                        <td style="border: 1px solid #374151; padding: 8px 4px; text-align: left; font-size: 10px;">${malzeme}</td>
                        <td style="border: 1px solid #374151; padding: 8px 4px; text-align: left; font-size: 10px;">${detay1}</td>
                        <td style="border: 1px solid #374151; padding: 8px 4px; text-align: left; font-size: 10px;">${detay2}</td>
                        <td style="border: 1px solid #374151; padding: 8px 4px; text-align: center; font-size: 10px;">${birim}</td>
                        <td style="border: 1px solid #374151; padding: 8px 4px; text-align: center; font-weight: 600;">${talepMiktari}</td>
                        <td style="border: 1px solid #374151; padding: 8px 4px; text-align: center; font-weight: 600;">${siparisMiktari}</td>
                        <td style="border: 1px solid #374151; padding: 8px 4px; text-align: right; font-weight: 600;">â‚½ ${parseFloat(birimFiyat).toLocaleString('tr-TR', {minimumFractionDigits: 2})}</td>
                        <td style="border: 1px solid #374151; padding: 8px 4px; text-align: right; font-weight: bold; background-color: #f3f4f6;">â‚½ ${toplam.toLocaleString('tr-TR', {minimumFractionDigits: 2})}</td>
                    </tr>
                `;
            });
            
            return `
                <div style="width: 100%; min-height: 297mm; background: white; border: 2px solid #d1d5db; padding: 0; margin: 0; font-family: 'Calibri', 'Arial', sans-serif;">
                    <!-- Ãœst BÃ¶lÃ¼m -->
                    <div style="margin-bottom: 30px;">
                        <!-- Logo ve Tarih -->
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 25px;">
                            <div style="flex-shrink: 0;">
                                <img src="https://www.somtech.com.tr/wp-content/uploads/2024/01/logo.png" 
                                     alt="SomTech Logo" 
                                     style="width: 120px; height: auto;"
                                     onerror="this.style.display='none';">
                            </div>
                            <div style="flex-shrink: 0; text-align: right;">
                                <div style="background-color: #f3f4f6; padding: 12px 16px; border-radius: 8px; border: 1px solid #d1d5db;">
                                    <span style="font-size: 12px; font-weight: 600; color: #374151;">ðŸ“… Tarih: </span>
                                    <span style="font-size: 12px; font-weight: bold; color: #000;">${currentDate}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- BaÅŸlÄ±k - OrtalanmÄ±ÅŸ -->
                        <div style="text-align: center; margin-bottom: 25px;">
                            <h1 style="font-size: 24px; font-weight: bold; color: #1f2937; margin-bottom: 12px; margin-top: 0;">${formTitle}</h1>
                            <div style="width: 100%; height: 2px; background-color: #cf2e26; margin-bottom: 16px;"></div>
                            <p style="font-size: 16px; font-weight: 600; color: #4b5563; margin: 0;">${companyInfo}</p>
                        </div>
                    </div>

                    <!-- Tablo -->
                    <div style="margin-bottom: 25px; overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse; border: 2px solid #374151; font-size: 10px;">
                            <thead>
                                <tr style="background-color: #1e40af; color: white;">
                                    <th style="border: 1px solid #374151; padding: 8px 4px; text-align: center; font-weight: bold; width: 8%;">SIRA NO</th>
                                    <th style="border: 1px solid #374151; padding: 8px 4px; text-align: center; font-weight: bold; width: 12%;">Ä°STENEN TESLÄ°M TARÄ°HÄ°</th>
                                    <th style="border: 1px solid #374151; padding: 8px 4px; text-align: center; font-weight: bold; width: 20%;">TALEP EDÄ°LEN MALZEME</th>
                                    <th style="border: 1px solid #374151; padding: 8px 4px; text-align: center; font-weight: bold; width: 15%;">DETAY 1 (MARKA, MODEL VB)</th>
                                    <th style="border: 1px solid #374151; padding: 8px 4px; text-align: center; font-weight: bold; width: 15%;">DETAY 2 (PROJE, STANDART VB KODLAR)</th>
                                    <th style="border: 1px solid #374151; padding: 8px 4px; text-align: center; font-weight: bold; width: 8%;">BÄ°RÄ°M</th>
                                    <th style="border: 1px solid #374151; padding: 8px 4px; text-align: center; font-weight: bold; width: 8%;">TALEP MÄ°KTARI</th>
                                    <th style="border: 1px solid #374151; padding: 8px 4px; text-align: center; font-weight: bold; width: 8%;">SÄ°PARÄ°Åž MÄ°KTARI</th>
                                    <th style="border: 1px solid #374151; padding: 8px 4px; text-align: center; font-weight: bold; width: 12%;">BÄ°RÄ°M FÄ°YAT (â‚½ RUB)</th>
                                    <th style="border: 1px solid #374151; padding: 8px 4px; text-align: center; font-weight: bold; width: 12%;">TOPLAM FÄ°YAT (â‚½ RUB)</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${tableRows}
                            </tbody>
                            <tfoot>
                                <tr style="background-color: #e5e7eb;">
                                    <td colspan="9" style="border: 1px solid #374151; padding: 8px 4px; text-align: right; font-weight: bold; font-size: 12px;">GENEL TOPLAM (â‚½ RUB):</td>
                                    <td style="border: 1px solid #374151; padding: 8px 4px; font-weight: bold; font-size: 14px; text-align: right; background-color: #fef3c7;">â‚½ ${grandTotal.toLocaleString('tr-TR', {minimumFractionDigits: 2})}</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>

                    <!-- Ä°mza AlanlarÄ± -->
                    <div style="margin-top: 40px; margin-bottom: 30px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 30px; text-align: center;">
                            <div>
                                <div style="border-bottom: 2px solid #000; height: 50px; margin-bottom: 8px; position: relative;">
                                    <div style="position: absolute; bottom: -12px; left: 50%; transform: translateX(-50%); font-size: 16px; color: #000;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
                                </div>
                                <p style="font-weight: bold; font-size: 12px; margin: 12px 0 4px 0;">${signature1Name}</p>
                                <p style="font-size: 10px; color: #6b7280; margin: 0;">${signature1Title}</p>
                            </div>
                            <div>
                                <div style="border-bottom: 2px solid #000; height: 50px; margin-bottom: 8px; position: relative;">
                                    <div style="position: absolute; bottom: -12px; left: 50%; transform: translateX(-50%); font-size: 16px; color: #000;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
                                </div>
                                <p style="font-weight: bold; font-size: 12px; margin: 12px 0 4px 0;">${signature2Name}</p>
                                <p style="font-size: 10px; color: #6b7280; margin: 0;">${signature2Title}</p>
                            </div>
                            <div>
                                <div style="border-bottom: 2px solid #000; height: 50px; margin-bottom: 8px; position: relative;">
                                    <div style="position: absolute; bottom: -12px; left: 50%; transform: translateX(-50%); font-size: 16px; color: #000;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
                                </div>
                                <p style="font-weight: bold; font-size: 12px; margin: 12px 0 4px 0;">${signature3Name}</p>
                                <p style="font-size: 10px; color: #6b7280; margin: 0;">${signature3Title}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Elektronik Belge Notu -->
                    <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                        <p style="font-size: 10px; color: #6b7280; font-style: italic; margin: 0;">*Bu belge elektronik ortamda hazÄ±rlanmÄ±ÅŸtÄ±r.*</p>
                    </div>
                </div>
            `;
        }

        // YazdÄ±rma fonksiyonu
        function printForm() {
            showMessage('YazdÄ±rma hazÄ±rlanÄ±yor...', 'info');
            
            // YazdÄ±rma Ã¶ncesi stil ayarlarÄ±
            const originalTitle = document.title;
            document.title = 'SomTech SipariÅŸ Onay Formu';
            
            // YazdÄ±r
            window.print();
            
            // BaÅŸlÄ±ÄŸÄ± geri yÃ¼kle
            document.title = originalTitle;
            
            showMessage('YazdÄ±rma penceresi aÃ§Ä±ldÄ±!', 'success');
        }

        // Klavye kÄ±sayollarÄ±
        document.addEventListener('keydown', function(e) {
            // Ctrl+P - YazdÄ±r
            if (e.ctrlKey && e.key === 'p') {
                e.preventDefault();
                printForm();
            }
            
            // Ctrl+S - PDF Ä°ndir
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                downloadPDF();
            }
            
            // Ctrl+N - Yeni SatÄ±r
            if (e.ctrlKey && e.key === 'n') {
                e.preventDefault();
                addRow();
            }
            
            // Delete - SatÄ±r Sil (sadece tablo iÃ§indeyken)
            if (e.key === 'Delete' && e.target.closest('table')) {
                removeRow();
            }
        });

        // Otomatik kaydetme (localStorage)
        function autoSave() {
            const formData = {
                rows: [],
                timestamp: new Date().toISOString()
            };
            
            const tbody = document.getElementById('table-body');
            Array.from(tbody.children).forEach(row => {
                const inputs = row.querySelectorAll('input');
                const rowData = {
                    date: inputs[0].value,
                    material: inputs[1].value,
                    detail1: inputs[2].value,
                    detail2: inputs[3].value,
                    unit: inputs[4].value,
                    requestQty: inputs[5].value,
                    orderQty: inputs[6].value,
                    unitPrice: inputs[7].value
                };
                formData.rows.push(rowData);
            });
            
            localStorage.setItem('somtech_form_data', JSON.stringify(formData));
        }

        // Otomatik yÃ¼kleme
        function autoLoad() {
            const savedData = localStorage.getItem('somtech_form_data');
            if (savedData) {
                try {
                    const formData = JSON.parse(savedData);
                    const tbody = document.getElementById('table-body');
                    tbody.innerHTML = '';
                    rowCount = 0;
                    
                    formData.rows.forEach(rowData => {
                        addRow();
                        const row = tbody.lastElementChild;
                        const inputs = row.querySelectorAll('input');
                        
                        inputs[0].value = rowData.date || '';
                        inputs[1].value = rowData.material || '';
                        inputs[2].value = rowData.detail1 || '';
                        inputs[3].value = rowData.detail2 || '';
                        inputs[4].value = rowData.unit || '';
                        inputs[5].value = rowData.requestQty || '';
                        inputs[6].value = rowData.orderQty || '';
                        inputs[7].value = rowData.unitPrice || '';
                        
                        // ToplamlarÄ± hesapla
                        if (inputs[5].value && inputs[7].value) {
                            calculateRowTotal(inputs[5]);
                        }
                    });
                    
                    showMessage('Ã–nceki veriler yÃ¼klendi!', 'info');
                } catch (error) {
                    console.error('Veri yÃ¼kleme hatasÄ±:', error);
                }
            }
        }

        // Form deÄŸiÅŸikliklerini dinle ve otomatik kaydet
        document.addEventListener('input', function(e) {
            if (e.target.closest('.print-page')) {
                clearTimeout(window.autoSaveTimeout);
                window.autoSaveTimeout = setTimeout(autoSave, 2000); // 2 saniye sonra kaydet
            }
        });

        // Sayfa yÃ¼klendiÄŸinde
        document.addEventListener('DOMContentLoaded', function() {
            setCurrentDate();
            
            // Ã–nceki verileri yÃ¼kle
            autoLoad();
            
            // EÄŸer veri yoksa 3 boÅŸ satÄ±r ekle
            if (document.getElementById('table-body').children.length === 0) {
                for (let i = 0; i < 3; i++) {
                    addRow();
                }
            }
            
            // HoÅŸ geldin mesajÄ±
            setTimeout(() => {
                showMessage('SomTech SipariÅŸ Onay Formu hazÄ±r! Klavye kÄ±sayollarÄ±: Ctrl+P (YazdÄ±r), Ctrl+S (PDF), Ctrl+N (Yeni SatÄ±r)', 'info');
            }, 1000);
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98fe131d6127d25d',t:'MTc2MDY4NjA1OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>