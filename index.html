<!doctype html>
<html lang="tr">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SOMTECH_SOF v1.9.8 - Material Management System</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
        }

        :root {
            /* Light theme colors */
            --bg-primary: #f8fafc;
            --bg-secondary: rgba(255, 255, 255, 0.8);
            --bg-glass: rgba(255, 255, 255, 0.25);
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: rgba(148, 163, 184, 0.2);
            --shadow-color: rgba(0, 0, 0, 0.1);
            --accent-color: #22d3ee;
            --accent-hover: #06b6d4;
            --sidebar-bg: rgba(255, 255, 255, 0.9);
            --header-bg: rgba(255, 255, 255, 0.95);
        }

        [data-theme="dark"] {
            /* Dark theme colors */
            --bg-primary: #0f172a;
            --bg-secondary: rgba(30, 41, 59, 0.8);
            --bg-glass: rgba(30, 41, 59, 0.4);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: rgba(71, 85, 105, 0.3);
            --shadow-color: rgba(0, 0, 0, 0.3);
            --accent-color: #22d3ee;
            --accent-hover: #67e8f9;
            --sidebar-bg: rgba(15, 23, 42, 0.9);
            --header-bg: rgba(15, 23, 42, 0.95);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .app-container {
            display: flex;
            height: 100%;
            overflow: hidden;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 280px;
            background: var(--sidebar-bg);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 10;
        }

        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--accent-color)10, transparent 50%);
            opacity: 0.05;
            pointer-events: none;
        }

        .logo-section {
            padding: 24px 20px;
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent-color), var(--accent-hover));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(34, 211, 238, 0.3);
        }

        .logo-text {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.025em;
        }

        .nav-menu {
            flex: 1;
            padding: 20px 0;
            overflow-y: auto;
        }

        .nav-item {
            margin: 0 16px 8px;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .nav-button {
            width: 100%;
            padding: 14px 20px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }

        .nav-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-glass);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .nav-button:hover {
            color: var(--text-primary);
            transform: translateX(4px);
        }

        .nav-button:hover::before {
            opacity: 1;
        }

        .nav-button.active {
            color: var(--accent-color);
            background: var(--bg-glass);
            box-shadow: 0 4px 12px var(--shadow-color);
        }

        .nav-button.active::before {
            opacity: 1;
            background: linear-gradient(135deg, var(--accent-color)20, transparent);
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Header Styles */
        .header {
            height: 70px;
            background: var(--header-bg);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 0 24px;
            gap: 16px;
            position: relative;
            z-index: 5;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--bg-glass);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .language-selector select,
        .role-selector select {
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            outline: none;
        }

        .language-selector select option,
        .role-selector select option {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .icon-button {
            width: 40px;
            height: 40px;
            background: var(--bg-glass);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            font-size: 16px;
        }

        .icon-button:hover {
            background: var(--accent-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(34, 211, 238, 0.4);
        }

        .theme-toggle {
            position: relative;
        }

        .theme-toggle .icon {
            transition: all 0.3s ease;
        }

        [data-theme="dark"] .theme-toggle .sun-icon {
            opacity: 0;
            transform: rotate(180deg);
        }

        [data-theme="light"] .theme-toggle .moon-icon {
            opacity: 0;
            transform: rotate(-180deg);
        }

        .notification-badge {
            position: relative;
        }

        .notification-badge::after {
            content: '';
            position: absolute;
            top: 8px;
            right: 8px;
            width: 8px;
            height: 8px;
            background: #ef4444;
            border-radius: 50%;
            border: 2px solid var(--bg-primary);
        }

        /* Content Area */
        .content-area {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
            background: var(--bg-primary);
        }

        .page-view {
            display: none;
        }

        .page-view.active {
            display: block;
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .page-subtitle {
            font-size: 16px;
            color: #8a93a6;
        }

        /* Summary Cards */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .summary-card {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 32px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-hover));
        }

        .summary-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px var(--shadow-color);
        }

        .summary-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, var(--accent-color)20, var(--accent-hover)20);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }

        .summary-count {
            font-size: 36px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 8px;
            line-height: 1;
        }

        .summary-label {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .summary-description {
            font-size: 14px;
            color: #8a93a6;
        }

        /* Table Styles */
        .table-container {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 32px var(--shadow-color);
        }

        .table-header {
            padding: 24px 32px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }

        .table-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .table-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .search-box {
            padding: 10px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 14px;
            width: 240px;
            transition: all 0.3s ease;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(34, 211, 238, 0.1);
        }

        .filter-button {
            padding: 10px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-button:hover {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .table-wrapper {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .data-table thead {
            position: sticky;
            top: 0;
            z-index: 2;
        }

        .data-table th {
            background: var(--bg-secondary);
            backdrop-filter: blur(20px);
            color: var(--text-primary);
            font-weight: 600;
            padding: 16px 12px;
            text-align: left;
            border-bottom: 2px solid var(--border-color);
            white-space: nowrap;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .data-table td {
            padding: 16px 12px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary);
            vertical-align: middle;
        }

        .data-table tbody tr {
            transition: all 0.2s ease;
        }

        .data-table tbody tr:hover {
            background: var(--bg-glass);
            transform: scale(1.01);
        }

        .data-table tbody tr:nth-child(even) {
            background: rgba(148, 163, 184, 0.02);
        }

        .data-table tbody tr:nth-child(even):hover {
            background: var(--bg-glass);
        }

        /* Status Tags */
        .status-tag {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-tag.sarf {
            background: rgba(34, 197, 94, 0.15);
            color: #16a34a;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .status-tag.demirbas {
            background: rgba(249, 115, 22, 0.15);
            color: #ea580c;
            border: 1px solid rgba(249, 115, 22, 0.3);
        }

        .status-tag.pending {
            background: rgba(234, 179, 8, 0.15);
            color: #ca8a04;
            border: 1px solid rgba(234, 179, 8, 0.3);
        }

        .status-tag.completed {
            background: rgba(34, 197, 94, 0.15);
            color: #16a34a;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .status-tag.cancelled {
            background: rgba(239, 68, 68, 0.15);
            color: #dc2626;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* Action Buttons */
        .action-button {
            padding: 8px 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-right: 4px;
        }

        .action-button:hover {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .action-button.edit {
            color: #3b82f6;
            border-color: rgba(59, 130, 246, 0.3);
        }

        .action-button.delete {
            color: #ef4444;
            border-color: rgba(239, 68, 68, 0.3);
        }

        .link-button {
            color: var(--accent-color);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .link-button:hover {
            color: var(--accent-hover);
            text-decoration: underline;
        }

        /* Secondary Text */
        .secondary-text {
            color: #8a93a6;
            font-size: 13px;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 18px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            transform: scale(0.9) translateY(20px);
            transition: all 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            padding: 24px 32px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
        }

        .modal-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-hover));
            border-radius: 18px 18px 0 0;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
            color: var(--text-secondary);
        }

        .modal-close:hover {
            background: #ef4444;
            color: white;
            border-color: #ef4444;
            transform: scale(1.1);
        }

        .modal-body {
            padding: 32px;
        }

        .modal-footer {
            padding: 20px 32px 32px;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            border-top: 1px solid var(--border-color);
        }

        /* Form Styles */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .ai-badge {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-hover));
            color: white;
            font-size: 10px;
            font-weight: 700;
            padding: 3px 8px;
            border-radius: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(34, 211, 238, 0.3);
            animation: pulse-glow 2s ease-in-out infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { 
                box-shadow: 0 2px 8px rgba(34, 211, 238, 0.3);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 4px 16px rgba(34, 211, 238, 0.5);
                transform: scale(1.05);
            }
        }

        .form-input,
        .form-select,
        .form-textarea {
            padding: 12px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(34, 211, 238, 0.1);
            background: var(--bg-glass);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-select {
            cursor: pointer;
        }

        /* Button Styles */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-hover));
            color: white;
            box-shadow: 0 4px 12px rgba(34, 211, 238, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(34, 211, 238, 0.4);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-glass);
            transform: translateY(-1px);
        }

        .btn-outline {
            background: transparent;
            color: var(--accent-color);
            border: 1px solid var(--accent-color);
        }

        .btn-outline:hover {
            background: var(--accent-color);
            color: white;
        }

        /* Timeline Styles */
        .timeline {
            position: relative;
            padding-left: 32px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 12px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(180deg, var(--accent-color), var(--accent-hover));
            border-radius: 1px;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 24px;
            padding: 16px 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .timeline-item:hover {
            background: var(--bg-glass);
            transform: translateX(4px);
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -26px;
            top: 20px;
            width: 12px;
            height: 12px;
            background: var(--accent-color);
            border: 3px solid var(--bg-primary);
            border-radius: 50%;
            box-shadow: 0 0 0 2px var(--accent-color);
        }

        .timeline-date {
            font-size: 12px;
            font-weight: 600;
            color: var(--accent-color);
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .timeline-status {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .timeline-description {
            font-size: 13px;
            color: #8a93a6;
            line-height: 1.4;
        }

        /* Add Record Button */
        .add-record-btn {
            position: fixed;
            bottom: 32px;
            right: 32px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--accent-color), var(--accent-hover));
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 8px 24px rgba(34, 211, 238, 0.4);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .add-record-btn:hover {
            transform: scale(1.1) translateY(-2px);
            box-shadow: 0 12px 32px rgba(34, 211, 238, 0.5);
        }

        /* Material Row Styles */
        .material-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr 1fr auto;
            gap: 12px;
            align-items: end;
            padding: 16px;
            background: var(--bg-glass);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin-bottom: 16px;
            position: relative;
            transition: all 0.3s ease;
        }

        .material-row:hover {
            background: rgba(34, 211, 238, 0.05);
            border-color: rgba(34, 211, 238, 0.3);
        }

        .material-row::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-hover));
            border-radius: 12px 12px 0 0;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .material-row:hover::before {
            opacity: 1;
        }

        .material-row .form-group {
            margin-bottom: 0;
        }

        .remove-material-btn {
            width: 36px;
            height: 36px;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            color: #ef4444;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .remove-material-btn:hover {
            background: #ef4444;
            color: white;
            transform: scale(1.1);
        }

        /* AI Processing Animation */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .ai-processing-spinner {
            animation: spin 1s linear infinite;
        }

        /* Toast Notification Styles */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .toast {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px 20px;
            color: var(--text-primary);
            box-shadow: 0 8px 32px var(--shadow-color);
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.3s ease;
            max-width: 350px;
            position: relative;
            overflow: hidden;
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-hover));
        }

        .toast.success::before {
            background: linear-gradient(90deg, #22c55e, #16a34a);
        }

        .toast.error::before {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }

        .toast.warning::before {
            background: linear-gradient(90deg, #f59e0b, #d97706);
        }

        .toast-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toast-icon {
            font-size: 20px;
            flex-shrink: 0;
        }

        .toast-message {
            flex: 1;
            font-size: 14px;
            font-weight: 500;
            line-height: 1.4;
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 18px;
            padding: 0;
            margin-left: 8px;
            transition: color 0.2s ease;
        }

        .toast-close:hover {
            color: var(--text-primary);
        }

        /* Responsive Design Updates */
        @media (max-width: 1200px) {
            .summary-grid {
                grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            }
            
            .material-row {
                grid-template-columns: 1fr;
                gap: 16px;
            }
        }

        @media (max-width: 768px) {
            .modal {
                width: 95%;
                margin: 20px;
            }
            
            .modal-header,
            .modal-body,
            .modal-footer {
                padding: 20px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .add-record-btn {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            
            .content-area {
                padding: 20px;
            }
            
            .summary-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .summary-card {
                padding: 24px;
            }
            
            .table-header {
                padding: 20px;
                flex-direction: column;
                align-items: stretch;
            }
            
            .table-actions {
                flex-direction: column;
            }
            
            .search-box {
                width: 100%;
            }
            
            .data-table th,
            .data-table td {
                padding: 12px 8px;
                font-size: 12px;
            }
            
            .sidebar {
                width: 240px;
            }
            
            .header {
                padding: 0 16px;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body data-theme="dark">
  <div class="app-container"><!-- Sidebar -->
   <aside class="sidebar">
    <div class="logo-section">
     <div class="logo">
      <div class="logo-icon">
       <svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="white" stroke-width="2" stroke-linejoin="round" /> <path d="M2 17L12 22L22 17" stroke="white" stroke-width="2" stroke-linejoin="round" /> <path d="M2 12L12 17L22 12" stroke="white" stroke-width="2" stroke-linejoin="round" />
       </svg>
      </div><span class="logo-text" id="app-title">SOMTECH_SOF v1.9.8</span>
     </div>
    </div>
    <nav class="nav-menu">
     <div class="nav-item"><button class="nav-button active" data-page="overview" id="nav-overview">√ñzet</button>
     </div>
     <div class="nav-item"><button class="nav-button" data-page="records" id="nav-records">Kayƒ±t Tablosu</button>
     </div>
     <div class="nav-item"><button class="nav-button" data-page="report-form" id="nav-report-form">Rapor Formu</button>
     </div>
     <div class="nav-item"><button class="nav-button" data-page="reports" id="nav-reports">Raporlar</button>
     </div>
     <div class="nav-item"><button class="nav-button" data-page="settings" id="nav-settings">Ayarlar</button>
     </div>
     <div class="nav-item"><button class="nav-button" data-page="new-request" id="nav-new-request">Yeni Talep Olu≈ütur</button>
     </div>
    </nav>
   </aside><!-- Main Content -->
   <main class="main-content"><!-- Header -->
    <header class="header">
     <div class="header-controls"><!-- Language Selector -->
      <div class="control-group language-selector"><select id="language-select"> <option value="tr">TR</option> <option value="en">EN</option> <option value="ru">RU</option> </select>
      </div><!-- User Role Selector -->
      <div class="control-group role-selector"><select id="role-select"> <option value="satin-alma">Satƒ±n Alma</option> <option value="muhasebe">Muhasebe</option> <option value="mudur">M√ºd√ºr</option> <option value="birim-kullanicisi">Birim Kullanƒ±cƒ±sƒ±</option> </select>
      </div><!-- Theme Toggle --> <button class="icon-button theme-toggle" id="theme-toggle"> <span class="icon sun-icon">‚òÄÔ∏è</span> <span class="icon moon-icon" style="position: absolute;">üåô</span> </button> <!-- Notifications --> <button class="icon-button notification-badge" id="notifications"> üîî </button>
     </div>
    </header><!-- Content Area -->
    <div class="content-area"><!-- √ñzet (Summary) View -->
     <div class="page-view active" id="overview-view">
      <div class="page-header">
       <h1 class="page-title">√ñzet</h1>
       <p class="page-subtitle">Malzeme y√∂netim sistemi genel durumu</p>
      </div>
      <div class="summary-grid">
       <div class="summary-card">
        <div class="summary-icon">
         üîß
        </div>
        <div class="summary-count" id="sarf-count">
         247
        </div>
        <div class="summary-label">
         Sarf Malzemesi
        </div>
        <div class="summary-description">
         T√ºketim malzemeleri
        </div>
       </div>
       <div class="summary-card">
        <div class="summary-icon">
         üèóÔ∏è
        </div>
        <div class="summary-count" id="demirbas-count">
         89
        </div>
        <div class="summary-label">
         Demirba≈ü
        </div>
        <div class="summary-description">
         Sabit kƒ±ymet malzemeleri
        </div>
       </div>
       <div class="summary-card">
        <div class="summary-icon">
         üìä
        </div>
        <div class="summary-count" id="total-count">
         336
        </div>
        <div class="summary-label">
         Toplam
        </div>
        <div class="summary-description">
         T√ºm malzeme kayƒ±tlarƒ±
        </div>
       </div>
      </div>
     </div><!-- Kayƒ±t Tablosu (Records Table) View -->
     <div class="page-view" id="records-view">
      <div class="page-header">
       <h1 class="page-title">Kayƒ±t Tablosu</h1>
       <p class="page-subtitle">T√ºm malzeme kayƒ±tlarƒ± ve detaylarƒ±</p>
      </div>
      <div class="table-container">
       <div class="table-header">
        <h2 class="table-title">Malzeme Kayƒ±tlarƒ±</h2>
        <div class="table-actions"><input type="text" class="search-box" placeholder="Malzeme ara..." id="search-input"> <button class="filter-button" id="filter-btn">Filtrele</button> <button class="filter-button" id="export-btn">Dƒ±≈üa Aktar</button>
        </div>
       </div>
       <div class="table-wrapper">
        <table class="data-table">
         <thead>
          <tr>
           <th>SOF NO</th>
           <th>Talep Tarihi</th>
           <th>Malzeme</th>
           <th>Birim</th>
           <th>Ana T√ºr</th>
           <th>Tip</th>
           <th>Adet</th>
           <th>Termin Tarihi</th>
           <th>Talep Eden</th>
           <th>Link</th>
           <th>Durum</th>
           <th>ƒ∞≈ülem</th>
          </tr>
         </thead>
         <tbody id="records-tbody"><!-- Sample data will be replaced by localStorage data -->
          <tr>
           <td><strong>SMT-SOFS-2024-0001</strong></td>
           <td class="secondary-text">15.01.2024</td>
           <td>√áelik Boru 50mm</td>
           <td class="secondary-text">Adet</td>
           <td><span class="status-tag sarf">Sarf</span></td>
           <td class="secondary-text">Yapƒ± Malzemesi</td>
           <td><strong>25</strong></td>
           <td class="secondary-text">30.01.2024</td>
           <td>Ahmet Yƒ±lmaz</td>
           <td><a href="#" class="link-button">Detay</a></td>
           <td><span class="status-tag completed">Tamamlandƒ±</span></td>
           <td><button class="action-button edit">D√ºzenle</button> <button class="action-button delete">Sil</button></td>
          </tr>
         </tbody>
        </table>
       </div>
      </div>
     </div><!-- Other Views (Placeholder) -->
     <div class="page-view" id="report-form-view">
      <div class="page-header">
       <h1 class="page-title">Rapor Formu</h1>
       <p class="page-subtitle">Yeni rapor olu≈üturma formu</p>
      </div>
      <div class="summary-card" style="text-align: center; padding: 60px;">
       <div class="summary-icon">
        üìù
       </div>
       <h3 style="margin: 20px 0;">Rapor Formu</h3>
       <p class="secondary-text">Bu b√∂l√ºm yakƒ±nda aktif olacak</p>
      </div>
     </div>
     <div class="page-view" id="reports-view">
      <div class="page-header">
       <h1 class="page-title">Raporlar</h1>
       <p class="page-subtitle">Olu≈üturulan raporlar ve analizler</p>
      </div>
      <div class="summary-card" style="text-align: center; padding: 60px;">
       <div class="summary-icon">
        üìä
       </div>
       <h3 style="margin: 20px 0;">Raporlar</h3>
       <p class="secondary-text">Bu b√∂l√ºm yakƒ±nda aktif olacak</p>
      </div>
     </div>
     <div class="page-view" id="settings-view">
      <div class="page-header">
       <h1 class="page-title">Ayarlar</h1>
       <p class="page-subtitle">Sistem ayarlarƒ± ve konfig√ºrasyon</p>
      </div>
      <div class="summary-card" style="text-align: center; padding: 60px;">
       <div class="summary-icon">
        ‚öôÔ∏è
       </div>
       <h3 style="margin: 20px 0;">Ayarlar</h3>
       <p class="secondary-text">Bu b√∂l√ºm yakƒ±nda aktif olacak</p>
      </div>
     </div>
     <div class="page-view" id="new-request-view">
      <div class="page-header">
       <h1 class="page-title">Yeni Talep Olu≈ütur (AI Destekli)</h1>
       <p class="page-subtitle">Akƒ±llƒ± malzeme kategorilendirme ile hƒ±zlƒ± talep olu≈üturma</p>
      </div>
      <div class="table-container">
       <div class="table-header">
        <h2 class="table-title">ü§ñ AI Destekli Talep Formu</h2>
        <div class="table-actions"><button class="btn btn-primary" id="open-ai-request-modal"> ‚ú® Yeni Talep Olu≈ütur </button>
        </div>
       </div>
       <div style="padding: 40px; text-align: center;">
        <div class="summary-icon" style="margin: 0 auto 20px;">
         üöÄ
        </div>
        <h3 style="margin-bottom: 16px; color: var(--text-primary);">Akƒ±llƒ± Talep Sistemi</h3>
        <p class="secondary-text" style="max-width: 600px; margin: 0 auto; line-height: 1.6;">AI destekli sistem, malzeme adƒ±ndan otomatik olarak kategori ve t√ºr bilgilerini tespit eder. √áoklu malzeme ekleme √∂zelliƒüi ile tek seferde birden fazla √ºr√ºn talebinde bulunabilirsiniz.</p>
        <div style="margin-top: 24px;"><button class="btn btn-primary" id="open-ai-request-modal-alt"> üéØ Hemen Ba≈üla </button>
        </div>
       </div>
      </div>
     </div>
    </div>
   </main>
  </div><!-- Floating Add Record Button --> <button class="add-record-btn" id="add-record-btn" title="Yeni Kayƒ±t Ekle"> ‚ûï </button> <!-- New Record Modal -->
  <div class="modal-overlay" id="new-record-modal">
   <div class="modal">
    <div class="modal-header">
     <h2 class="modal-title">Yeni Kayƒ±t</h2><button class="modal-close" id="close-new-record">‚úï</button>
    </div>
    <div class="modal-body">
     <form id="new-record-form">
      <div class="form-grid">
       <div class="form-group"><label class="form-label" for="talep-tarihi">Talep Tarihi</label> <input type="date" id="talep-tarihi" class="form-input" required>
       </div>
       <div class="form-group"><label class="form-label" for="malzeme">Malzeme</label> <input type="text" id="malzeme" class="form-input" placeholder="Malzeme adƒ±" required>
       </div>
       <div class="form-group"><label class="form-label" for="adet">Adet</label> <input type="number" id="adet" class="form-input" placeholder="Miktar" min="1" required>
       </div>
       <div class="form-group"><label class="form-label" for="ana-tur"> Ana T√ºr <span class="ai-badge">AI</span> </label> <select id="ana-tur" class="form-select" required> <option value="">Se√ßiniz</option> <option value="sarf">Sarf</option> <option value="demirbas">Demirba≈ü</option> </select>
       </div>
       <div class="form-group"><label class="form-label" for="tip"> Tip <span class="ai-badge">AI</span> </label> <select id="tip" class="form-select" required> <option value="">Se√ßiniz</option> <option value="yapisal">Yapƒ±sal Malzeme</option> <option value="elektronik">Elektronik</option> <option value="kirtasiye">Kƒ±rtasiye</option> <option value="baglanti">Baƒülantƒ± Elemanƒ±</option> <option value="tasima">Ta≈üƒ±ma Aracƒ±</option> <option value="makine">Makine</option> </select>
       </div>
       <div class="form-group"><label class="form-label" for="birim">Birim</label> <select id="birim" class="form-select" required> <option value="">Se√ßiniz</option> <option value="adet">Adet</option> <option value="kg">Kilogram</option> <option value="metre">Metre</option> <option value="litre">Litre</option> <option value="paket">Paket</option> <option value="kutu">Kutu</option> </select>
       </div>
       <div class="form-group"><label class="form-label" for="termin">Termin Tarihi</label> <input type="date" id="termin" class="form-input" required>
       </div>
       <div class="form-group"><label class="form-label" for="link">Link</label> <input type="url" id="link" class="form-input" placeholder="https://example.com">
       </div>
       <div class="form-group full-width"><label class="form-label" for="detay">Detay-1</label> <textarea id="detay" class="form-textarea" placeholder="Detaylƒ± a√ßƒ±klama"></textarea>
       </div>
       <div class="form-group full-width"><label class="form-label" for="aciklama">A√ßƒ±klama</label> <textarea id="aciklama" class="form-textarea" placeholder="Ek a√ßƒ±klamalar"></textarea>
       </div>
      </div>
     </form>
    </div>
    <div class="modal-footer"><button type="button" class="btn btn-secondary" id="cancel-new-record">ƒ∞ptal</button> <button type="submit" class="btn btn-primary" form="new-record-form"> üíæ Kaydet </button>
    </div>
   </div>
  </div><!-- Process Tracking Modal -->
  <div class="modal-overlay" id="process-modal">
   <div class="modal">
    <div class="modal-header">
     <h2 class="modal-title">Talep S√ºre√ß Takip</h2><button class="modal-close" id="close-process">‚úï</button>
    </div>
    <div class="modal-body">
     <div class="timeline">
      <div class="timeline-item">
       <div class="timeline-date">
        15 Ocak 2024 - 09:30
       </div>
       <div class="timeline-status">
        Talep Olu≈üturuldu
       </div>
       <div class="timeline-description">
        Yeni malzeme talebi sistem tarafƒ±ndan kaydedildi ve onay s√ºrecine alƒ±ndƒ±.
       </div>
      </div>
      <div class="timeline-item">
       <div class="timeline-date">
        15 Ocak 2024 - 14:15
       </div>
       <div class="timeline-status">
        Departman Onayƒ±
       </div>
       <div class="timeline-description">
        Departman y√∂neticisi tarafƒ±ndan onaylandƒ±. Satƒ±n alma birimine y√∂nlendirildi.
       </div>
      </div>
      <div class="timeline-item">
       <div class="timeline-date">
        18 Ocak 2024 - 11:45
       </div>
       <div class="timeline-status">
        Tedarik√ßi Se√ßimi
       </div>
       <div class="timeline-description">
        En uygun tedarik√ßi belirlendi ve fiyat teklifi alƒ±ndƒ±. Sipari≈ü hazƒ±rlƒ±ƒüƒ± ba≈ülatƒ±ldƒ±.
       </div>
      </div>
      <div class="timeline-item">
       <div class="timeline-date">
        22 Ocak 2024 - 16:20
       </div>
       <div class="timeline-status">
        Sipari≈ü Verildi
       </div>
       <div class="timeline-description">
        Tedarik√ßiye sipari≈ü verildi. Teslimat s√ºreci takibe alƒ±ndƒ±.
       </div>
      </div>
      <div class="timeline-item">
       <div class="timeline-date">
        30 Ocak 2024 - 08:00
       </div>
       <div class="timeline-status">
        Teslim Alƒ±ndƒ±
       </div>
       <div class="timeline-description">
        Malzemeler depoya teslim alƒ±ndƒ± ve kalite kontrol√º tamamlandƒ±. Talep kapatƒ±ldƒ±.
       </div>
      </div>
     </div>
    </div>
    <div class="modal-footer"><button type="button" class="btn btn-outline" id="export-timeline"> üìÑ Rapor Al </button> <button type="button" class="btn btn-secondary" id="close-process-footer"> Kapat </button>
    </div>
   </div>
  </div><!-- AI Enhanced Request Modal -->
  <div class="modal-overlay" id="ai-request-modal">
   <div class="modal" style="max-width: 900px;">
    <div class="modal-header">
     <h2 class="modal-title">ü§ñ AI Destekli Yeni Talep</h2><button class="modal-close" id="close-ai-request">‚úï</button>
    </div>
    <div class="modal-body"><!-- User Information Section -->
     <div style="margin-bottom: 32px; padding: 20px; background: var(--bg-secondary); border-radius: 12px; border: 1px solid var(--border-color);">
      <h3 style="margin-bottom: 16px; color: var(--text-primary); font-size: 16px; font-weight: 600;">üë§ Talep Eden Bilgileri</h3>
      <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
       <div class="form-group"><label class="form-label" for="ai-birim">Birim</label> <input type="text" id="ai-birim" class="form-input" placeholder="Otomatik doldurulacak" readonly>
       </div>
       <div class="form-group"><label class="form-label" for="ai-adi-soyadi">Adƒ± Soyadƒ±</label> <input type="text" id="ai-adi-soyadi" class="form-input" placeholder="Adƒ±nƒ±zƒ± ve soyadƒ±nƒ±zƒ± girin" required>
       </div>
      </div>
     </div><!-- Materials Section -->
     <div style="margin-bottom: 24px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
       <h3 style="color: var(--text-primary); font-size: 16px; font-weight: 600;">üõ†Ô∏è Malzeme Listesi</h3><button type="button" class="btn btn-outline" id="add-material-row"> ‚ûï Satƒ±r Ekle </button>
      </div>
      <div id="materials-container"><!-- Material rows will be added here dynamically -->
      </div>
     </div><!-- AI Status Display -->
     <div id="ai-status" style="display: none; padding: 12px 16px; background: rgba(34, 211, 238, 0.1); border: 1px solid rgba(34, 211, 238, 0.3); border-radius: 8px; margin-bottom: 20px;">
      <div style="display: flex; align-items: center; gap: 8px;">
       <div class="ai-processing-spinner" style="width: 16px; height: 16px; border: 2px solid var(--accent-color); border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div><span style="color: var(--accent-color); font-size: 14px; font-weight: 500;">AI kategorilendirme yapƒ±lƒ±yor...</span>
      </div>
     </div>
    </div>
    <div class="modal-footer"><button type="button" class="btn btn-secondary" id="cancel-ai-request">ƒ∞ptal</button> <button type="button" class="btn btn-primary" id="save-ai-request"> üíæ Talebi Kaydet </button>
    </div>
   </div>
  </div>
  <script>
        // ===== CORE SYSTEM MODULES =====

        /**
         * TOAST NOTIFICATION SYSTEM
         * Manages user feedback notifications with different types and animations
         */
        class ToastManager {
            constructor() {
                this.container = this.createContainer();
                document.body.appendChild(this.container);
                this.toasts = new Set(); // Track active toasts
            }

            /**
             * Create the toast container element
             * @returns {HTMLElement} Toast container
             */
            createContainer() {
                const container = document.createElement('div');
                container.className = 'toast-container';
                container.setAttribute('aria-live', 'polite');
                container.setAttribute('aria-atomic', 'true');
                return container;
            }

            /**
             * Show a toast notification
             * @param {string} message - Message to display
             * @param {string} type - Toast type (success, error, warning, info)
             * @param {number} duration - Display duration in milliseconds
             * @returns {HTMLElement} Created toast element
             */
            show(message, type = 'info', duration = 4000) {
                const toast = this.createToast(message, type);
                this.container.appendChild(toast);
                this.toasts.add(toast);

                // Trigger show animation
                requestAnimationFrame(() => {
                    toast.classList.add('show');
                });

                // Auto remove after duration
                setTimeout(() => this.remove(toast), duration);

                return toast;
            }

            /**
             * Create a toast element
             * @param {string} message - Toast message
             * @param {string} type - Toast type
             * @returns {HTMLElement} Toast element
             */
            createToast(message, type) {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.setAttribute('role', 'alert');

                const icons = {
                    success: '‚úÖ',
                    error: '‚ùå',
                    warning: '‚ö†Ô∏è',
                    info: '‚ÑπÔ∏è'
                };

                toast.innerHTML = `
                    <div class="toast-content">
                        <span class="toast-icon" aria-hidden="true">${icons[type] || icons.info}</span>
                        <span class="toast-message">${message}</span>
                        <button class="toast-close" aria-label="Bildirimi kapat" type="button">√ó</button>
                    </div>
                `;

                // Add close functionality
                toast.querySelector('.toast-close').addEventListener('click', () => {
                    this.remove(toast);
                });

                return toast;
            }

            /**
             * Remove a toast with animation
             * @param {HTMLElement} toast - Toast element to remove
             */
            remove(toast) {
                if (!this.toasts.has(toast)) return;

                toast.classList.remove('show');
                this.toasts.delete(toast);

                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }

            /**
             * Clear all active toasts
             */
            clearAll() {
                this.toasts.forEach(toast => this.remove(toast));
            }
        }

        /**
         * THEME MANAGEMENT SYSTEM
         * Handles light/dark theme switching with localStorage persistence
         */
        class ThemeManager {
            constructor() {
                this.currentTheme = this.loadTheme();
                this.applyTheme(this.currentTheme);
                this.initializeToggle();
            }

            /**
             * Load theme from localStorage or use default
             * @returns {string} Theme name ('light' or 'dark')
             */
            loadTheme() {
                const saved = localStorage.getItem('somtech_theme');
                return saved || 'dark'; // Default to dark theme
            }

            /**
             * Save theme to localStorage
             * @param {string} theme - Theme name to save
             */
            saveTheme(theme) {
                localStorage.setItem('somtech_theme', theme);
            }

            /**
             * Apply theme to document
             * @param {string} theme - Theme name to apply
             */
            applyTheme(theme) {
                document.body.setAttribute('data-theme', theme);
                this.currentTheme = theme;
            }

            /**
             * Toggle between light and dark themes
             */
            toggle() {
                const newTheme = this.currentTheme === 'light' ? 'dark' : 'light';
                this.applyTheme(newTheme);
                this.saveTheme(newTheme);
                
                // Provide user feedback
                const themeNames = { light: 'Aydƒ±nlƒ±k', dark: 'Karanlƒ±k' };
                window.toast?.show(`${themeNames[newTheme]} tema aktif edildi`, 'info', 2000);
            }

            /**
             * Initialize theme toggle button
             */
            initializeToggle() {
                const toggleBtn = document.getElementById('theme-toggle');
                if (toggleBtn) {
                    toggleBtn.addEventListener('click', () => this.toggle());
                }
            }

            /**
             * Get current theme
             * @returns {string} Current theme name
             */
            getCurrentTheme() {
                return this.currentTheme;
            }
        }

        /**
         * INTERNATIONALIZATION (i18n) SYSTEM
         * Manages multi-language support with text dictionary
         */
        class I18nManager {
            constructor() {
                this.currentLanguage = this.loadLanguage();
                this.dictionary = this.createDictionary();
                this.initializeSelector();
                this.applyLanguage(this.currentLanguage);
            }

            /**
             * Create the translation dictionary
             * @returns {Object} Translation dictionary
             */
            createDictionary() {
                return {
                    tr: {
                        // Navigation
                        nav_overview: '√ñzet',
                        nav_records: 'Kayƒ±t Tablosu',
                        nav_report_form: 'Rapor Formu',
                        nav_reports: 'Raporlar',
                        nav_settings: 'Ayarlar',
                        nav_new_request: 'Yeni Talep Olu≈ütur',
                        
                        // Page titles
                        page_overview_title: '√ñzet',
                        page_overview_subtitle: 'Malzeme y√∂netim sistemi genel durumu',
                        page_records_title: 'Kayƒ±t Tablosu',
                        page_records_subtitle: 'T√ºm malzeme kayƒ±tlarƒ± ve detaylarƒ±',
                        
                        // Summary cards
                        summary_sarf: 'Sarf Malzemesi',
                        summary_sarf_desc: 'T√ºketim malzemeleri',
                        summary_demirbas: 'Demirba≈ü',
                        summary_demirbas_desc: 'Sabit kƒ±ymet malzemeleri',
                        summary_total: 'Toplam',
                        summary_total_desc: 'T√ºm malzeme kayƒ±tlarƒ±',
                        
                        // Buttons and actions
                        btn_add_new: 'Yeni Kayƒ±t Ekle',
                        btn_search: 'Malzeme ara...',
                        btn_filter: 'Filtrele',
                        btn_export: 'Dƒ±≈üa Aktar',
                        btn_save: 'Kaydet',
                        btn_cancel: 'ƒ∞ptal',
                        btn_close: 'Kapat',
                        
                        // Messages
                        msg_theme_changed: 'tema aktif edildi',
                        msg_language_changed: 'Dil deƒüi≈ütirildi',
                        msg_role_changed: 'Rol deƒüi≈ütirildi',
                        msg_record_saved: 'Kayƒ±t ba≈üarƒ±yla eklendi',
                        msg_system_ready: 'SOMTECH_SOF v1.9.8 sistemi hazƒ±r'
                    },
                    en: {
                        // Navigation
                        nav_overview: 'Overview',
                        nav_records: 'Records Table',
                        nav_report_form: 'Report Form',
                        nav_reports: 'Reports',
                        nav_settings: 'Settings',
                        nav_new_request: 'Create New Request',
                        
                        // Page titles
                        page_overview_title: 'Overview',
                        page_overview_subtitle: 'Material management system overview',
                        page_records_title: 'Records Table',
                        page_records_subtitle: 'All material records and details',
                        
                        // Summary cards
                        summary_sarf: 'Consumables',
                        summary_sarf_desc: 'Consumption materials',
                        summary_demirbas: 'Fixed Assets',
                        summary_demirbas_desc: 'Fixed asset materials',
                        summary_total: 'Total',
                        summary_total_desc: 'All material records',
                        
                        // Buttons and actions
                        btn_add_new: 'Add New Record',
                        btn_search: 'Search materials...',
                        btn_filter: 'Filter',
                        btn_export: 'Export',
                        btn_save: 'Save',
                        btn_cancel: 'Cancel',
                        btn_close: 'Close',
                        
                        // Messages
                        msg_theme_changed: 'theme activated',
                        msg_language_changed: 'Language changed',
                        msg_role_changed: 'Role changed',
                        msg_record_saved: 'Record successfully added',
                        msg_system_ready: 'SOMTECH_SOF v1.9.8 system ready'
                    },
                    ru: {
                        // Navigation
                        nav_overview: '–û–±–∑–æ—Ä',
                        nav_records: '–¢–∞–±–ª–∏—Ü–∞ –∑–∞–ø–∏—Å–µ–π',
                        nav_report_form: '–§–æ—Ä–º–∞ –æ—Ç—á–µ—Ç–∞',
                        nav_reports: '–û—Ç—á–µ—Ç—ã',
                        nav_settings: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏',
                        nav_new_request: '–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å',
                        
                        // Page titles
                        page_overview_title: '–û–±–∑–æ—Ä',
                        page_overview_subtitle: '–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏',
                        page_records_title: '–¢–∞–±–ª–∏—Ü–∞ –∑–∞–ø–∏—Å–µ–π',
                        page_records_subtitle: '–í—Å–µ –∑–∞–ø–∏—Å–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏ –¥–µ—Ç–∞–ª–∏',
                        
                        // Summary cards
                        summary_sarf: '–†–∞—Å—Ö–æ–¥–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã',
                        summary_sarf_desc: '–ü–æ—Ç—Ä–µ–±–ª—è–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã',
                        summary_demirbas: '–û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞',
                        summary_demirbas_desc: '–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤',
                        summary_total: '–í—Å–µ–≥–æ',
                        summary_total_desc: '–í—Å–µ –∑–∞–ø–∏—Å–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤',
                        
                        // Buttons and actions
                        btn_add_new: '–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å',
                        btn_search: '–ü–æ–∏—Å–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤...',
                        btn_filter: '–§–∏–ª—å—Ç—Ä',
                        btn_export: '–≠–∫—Å–ø–æ—Ä—Ç',
                        btn_save: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å',
                        btn_cancel: '–û—Ç–º–µ–Ω–∞',
                        btn_close: '–ó–∞–∫—Ä—ã—Ç—å',
                        
                        // Messages
                        msg_theme_changed: '—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞',
                        msg_language_changed: '–Ø–∑—ã–∫ –∏–∑–º–µ–Ω–µ–Ω',
                        msg_role_changed: '–†–æ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∞',
                        msg_record_saved: '–ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞',
                        msg_system_ready: '–°–∏—Å—Ç–µ–º–∞ SOMTECH_SOF v1.9.8 –≥–æ—Ç–æ–≤–∞'
                    }
                };
            }

            /**
             * Load language from localStorage or use default
             * @returns {string} Language code
             */
            loadLanguage() {
                const saved = localStorage.getItem('somtech_language');
                return saved || 'tr'; // Default to Turkish
            }

            /**
             * Save language to localStorage
             * @param {string} language - Language code to save
             */
            saveLanguage(language) {
                localStorage.setItem('somtech_language', language);
            }

            /**
             * Get translated text
             * @param {string} key - Translation key
             * @returns {string} Translated text or key if not found
             */
            t(key) {
                return this.dictionary[this.currentLanguage]?.[key] || key;
            }

            /**
             * Apply language to UI elements
             * @param {string} language - Language code to apply
             */
            applyLanguage(language) {
                if (!this.dictionary[language]) return;

                this.currentLanguage = language;

                // Update navigation elements
                const navElements = {
                    'nav-overview': 'nav_overview',
                    'nav-records': 'nav_records',
                    'nav-report-form': 'nav_report_form',
                    'nav-reports': 'nav_reports',
                    'nav-settings': 'nav_settings',
                    'nav-new-request': 'nav_new_request'
                };

                Object.entries(navElements).forEach(([elementId, textKey]) => {
                    const element = document.getElementById(elementId);
                    if (element) {
                        element.textContent = this.t(textKey);
                    }
                });

                // Update page titles and subtitles
                this.updatePageTitles();
                
                // Update summary cards
                this.updateSummaryCards();
                
                // Update form elements
                this.updateFormElements();
            }

            /**
             * Update page titles and subtitles
             */
            updatePageTitles() {
                const titleElements = [
                    { selector: '#overview-view .page-title', key: 'page_overview_title' },
                    { selector: '#overview-view .page-subtitle', key: 'page_overview_subtitle' },
                    { selector: '#records-view .page-title', key: 'page_records_title' },
                    { selector: '#records-view .page-subtitle', key: 'page_records_subtitle' }
                ];

                titleElements.forEach(({ selector, key }) => {
                    const element = document.querySelector(selector);
                    if (element) {
                        element.textContent = this.t(key);
                    }
                });
            }

            /**
             * Update summary card texts
             */
            updateSummaryCards() {
                const summaryElements = [
                    { selector: '.summary-card:nth-child(1) .summary-label', key: 'summary_sarf' },
                    { selector: '.summary-card:nth-child(1) .summary-description', key: 'summary_sarf_desc' },
                    { selector: '.summary-card:nth-child(2) .summary-label', key: 'summary_demirbas' },
                    { selector: '.summary-card:nth-child(2) .summary-description', key: 'summary_demirbas_desc' },
                    { selector: '.summary-card:nth-child(3) .summary-label', key: 'summary_total' },
                    { selector: '.summary-card:nth-child(3) .summary-description', key: 'summary_total_desc' }
                ];

                summaryElements.forEach(({ selector, key }) => {
                    const element = document.querySelector(selector);
                    if (element) {
                        element.textContent = this.t(key);
                    }
                });
            }

            /**
             * Update form elements
             */
            updateFormElements() {
                // Update search placeholder
                const searchInput = document.getElementById('search-input');
                if (searchInput) {
                    searchInput.placeholder = this.t('btn_search');
                }

                // Update button texts
                const buttonElements = [
                    { selector: '#filter-btn', key: 'btn_filter' },
                    { selector: '#export-btn', key: 'btn_export' }
                ];

                buttonElements.forEach(({ selector, key }) => {
                    const element = document.querySelector(selector);
                    if (element) {
                        element.textContent = this.t(key);
                    }
                });
            }

            /**
             * Change language and update UI
             * @param {string} language - New language code
             */
            changeLanguage(language) {
                if (!this.dictionary[language]) return;

                this.applyLanguage(language);
                this.saveLanguage(language);
                
                // Update language selector
                const selector = document.getElementById('language-select');
                if (selector) {
                    selector.value = language;
                }

                // Provide user feedback
                window.toast?.show(`${this.t('msg_language_changed')}: ${language.toUpperCase()}`, 'info', 2000);
            }

            /**
             * Initialize language selector
             */
            initializeSelector() {
                const selector = document.getElementById('language-select');
                if (selector) {
                    selector.value = this.currentLanguage;
                    selector.addEventListener('change', (e) => {
                        this.changeLanguage(e.target.value);
                    });
                }
            }

            /**
             * Get current language
             * @returns {string} Current language code
             */
            getCurrentLanguage() {
                return this.currentLanguage;
            }
        }

        /**
         * USER ROLE MANAGEMENT SYSTEM
         * Manages user roles and permissions
         */
        class RoleManager {
            constructor() {
                this.currentRole = this.loadRole();
                this.roleDefinitions = this.createRoleDefinitions();
                this.initializeSelector();
            }

            /**
             * Create role definitions with permissions
             * @returns {Object} Role definitions
             */
            createRoleDefinitions() {
                return {
                    'satin-alma': {
                        name: 'Satƒ±n Alma',
                        permissions: ['view_all', 'edit_all', 'approve_requests', 'manage_suppliers'],
                        description: 'Satƒ±n alma i≈ülemlerini y√∂netir'
                    },
                    'muhasebe': {
                        name: 'Muhasebe',
                        permissions: ['view_all', 'edit_financial', 'approve_budget'],
                        description: 'Mali i≈ülemleri kontrol eder'
                    },
                    'mudur': {
                        name: 'M√ºd√ºr',
                        permissions: ['view_all', 'edit_all', 'approve_all', 'manage_users', 'system_admin'],
                        description: 'T√ºm yetkilere sahiptir'
                    },
                    'birim-kullanicisi': {
                        name: 'Birim Kullanƒ±cƒ±sƒ±',
                        permissions: ['view_own', 'create_request', 'edit_own'],
                        description: 'Kendi biriminin taleplerini y√∂netir'
                    }
                };
            }

            /**
             * Load role from localStorage or use default
             * @returns {string} Role code
             */
            loadRole() {
                const saved = localStorage.getItem('somtech_user_role');
                return saved || 'birim-kullanicisi'; // Default to basic user
            }

            /**
             * Save role to localStorage
             * @param {string} role - Role code to save
             */
            saveRole(role) {
                localStorage.setItem('somtech_user_role', role);
            }

            /**
             * Change user role
             * @param {string} role - New role code
             */
            changeRole(role) {
                if (!this.roleDefinitions[role]) return;

                this.currentRole = role;
                this.saveRole(role);
                
                // Update role selector
                const selector = document.getElementById('role-select');
                if (selector) {
                    selector.value = role;
                }

                // Apply role-based UI changes
                this.applyRolePermissions(role);

                // Provide user feedback
                const roleName = this.roleDefinitions[role].name;
                window.toast?.show(`Rol deƒüi≈ütirildi: ${roleName}`, 'info', 2000);
            }

            /**
             * Apply role-based permissions to UI
             * @param {string} role - Role code
             */
            applyRolePermissions(role) {
                const permissions = this.roleDefinitions[role]?.permissions || [];
                
                // Example: Hide/show elements based on permissions
                const adminElements = document.querySelectorAll('[data-admin-only]');
                adminElements.forEach(element => {
                    element.style.display = permissions.includes('system_admin') ? '' : 'none';
                });

                const managerElements = document.querySelectorAll('[data-manager-only]');
                managerElements.forEach(element => {
                    element.style.display = permissions.includes('approve_all') ? '' : 'none';
                });
            }

            /**
             * Check if current user has permission
             * @param {string} permission - Permission to check
             * @returns {boolean} Has permission
             */
            hasPermission(permission) {
                const permissions = this.roleDefinitions[this.currentRole]?.permissions || [];
                return permissions.includes(permission);
            }

            /**
             * Initialize role selector
             */
            initializeSelector() {
                const selector = document.getElementById('role-select');
                if (selector) {
                    selector.value = this.currentRole;
                    selector.addEventListener('change', (e) => {
                        this.changeRole(e.target.value);
                    });
                }
            }

            /**
             * Get current role information
             * @returns {Object} Current role data
             */
            getCurrentRole() {
                return {
                    code: this.currentRole,
                    ...this.roleDefinitions[this.currentRole]
                };
            }
        }

        // Initialize core systems
        const toast = new ToastManager();
        const themeManager = new ThemeManager();
        const i18n = new I18nManager();
        const roleManager = new RoleManager();

        // Make toast globally available
        window.toast = toast;

        // ===== AI CLASSIFICATION SYSTEM =====
        /**
         * AI-POWERED MATERIAL CLASSIFICATION SYSTEM
         * Automatically categorizes materials based on their names using pattern matching
         * Provides intelligent suggestions for "Ana T√ºr" and "Tip" fields
         */
        class AIClassifier {
            constructor() {
                this.classificationRules = this.createClassificationRules();
                this.processingDelay = { min: 800, max: 1200 }; // Realistic AI processing simulation
            }

            /**
             * Create comprehensive classification rules for material categorization
             * @returns {Object} Classification rules with regex patterns and categories
             */
            createClassificationRules() {
                return {
                    // Computer & Office Equipment -> Demirba≈ü
                    'bilgisayar|laptop|pc|monit√∂r|ekran|printer|yazƒ±cƒ±|scanner|tarayƒ±cƒ±|klavye|mouse|fare|tablet|telefon|server|switch|router|modem|ups|projektor': {
                        anaTur: 'demirbas',
                        tip: 'Bilgisayar Ekipmanƒ±',
                        confidence: 0.95
                    },
                    
                    // Electrical Materials -> Sarf
                    'kablo|fi≈ü|lamba|ampul|led|priz|sigorta|trafo|transformat√∂r|kondensat√∂r|diren√ß|elektronik|devre|√ßip|sens√∂r|r√∂le|kontakt√∂r': {
                        anaTur: 'sarf',
                        tip: 'Elektrik',
                        confidence: 0.90
                    },
                    
                    // Mechanical Materials -> Sarf
                    'boru|vana|pompa|motor|kayƒ±≈ü|rulman|vida|somun|pul|conta|ke√ße|yaƒü|gres|filtre|mafsal|zincir|di≈üli': {
                        anaTur: 'sarf',
                        tip: 'Mekanik',
                        confidence: 0.88
                    },
                    
                    // Furniture -> Demirba≈ü
                    'masa|sandalye|dolap|koltuk|kanepe|raf|kitaplƒ±k|mobilya|yatak|gardƒ±rop|√ßekmece|kapƒ±|pencere|perde': {
                        anaTur: 'demirbas',
                        tip: 'Mobilya',
                        confidence: 0.92
                    },
                    
                    // Office Supplies -> Sarf
                    'kaƒüƒ±t|kalem|defter|dosya|zƒ±mba|makas|bant|yapƒ±≈ütƒ±rƒ±cƒ±|silgi|cetvel|not|etiket|karton|zarf|klas√∂r': {
                        anaTur: 'sarf',
                        tip: 'Kƒ±rtasiye',
                        confidence: 0.85
                    },
                    
                    // Construction Materials -> Sarf
                    '√ßimento|kum|tuƒüla|kiremit|boya|fƒ±r√ßa|rulo|spatula|al√ßƒ±|sƒ±va|√ßivi|tel|demir|√ßelik|beton|har√ß': {
                        anaTur: 'sarf',
                        tip: 'Yapƒ± Malzemesi',
                        confidence: 0.87
                    },
                    
                    // Hand Tools -> Demirba≈ü
                    'matkap|testere|tornavida|anahtar|pense|√ßeki√ß|alet|takƒ±m|avadanlƒ±k|makine|cihaz|aparat': {
                        anaTur: 'demirbas',
                        tip: 'El Aletleri',
                        confidence: 0.83
                    },
                    
                    // Cleaning Supplies -> Sarf
                    'temizlik|deterjan|sabun|≈üampuan|dezenfektan|bez|s√ºp√ºrge|fƒ±r√ßa|s√ºnger|√ß√∂p|po≈üet|tuvalet': {
                        anaTur: 'sarf',
                        tip: 'Temizlik',
                        confidence: 0.80
                    },
                    
                    // Safety Equipment -> Mixed (depends on item)
                    'g√ºvenlik|emniyet|kask|eldiven|g√∂zl√ºk|maske|yelek|bot|ayakkabƒ±|koruma|alarm|kamera': {
                        anaTur: 'demirbas',
                        tip: 'G√ºvenlik Ekipmanƒ±',
                        confidence: 0.75
                    },
                    
                    // Medical/Health -> Mixed
                    'tƒ±bbi|saƒülƒ±k|ila√ß|bandaj|pamuk|alkol|termometre|tansiyon|oksijen|serum|enjekt√∂r': {
                        anaTur: 'sarf',
                        tip: 'Tƒ±bbi Malzeme',
                        confidence: 0.78
                    }
                };
            }

            /**
             * Classify material based on its name with confidence scoring
             * @param {string} materialName - Name of the material to classify
             * @returns {Object} Classification result with anaTur, tip, and confidence
             */
            classify(materialName) {
                if (!materialName || typeof materialName !== 'string') {
                    return this.getDefaultClassification();
                }

                const name = materialName.toLowerCase().trim();
                let bestMatch = null;
                let highestConfidence = 0;

                // Find the best matching pattern
                for (const [pattern, classification] of Object.entries(this.classificationRules)) {
                    const regex = new RegExp(pattern, 'i');
                    if (regex.test(name)) {
                        if (classification.confidence > highestConfidence) {
                            bestMatch = classification;
                            highestConfidence = classification.confidence;
                        }
                    }
                }

                // Return best match or default
                return bestMatch || this.getDefaultClassification();
            }

            /**
             * Get default classification for unmatched materials
             * @returns {Object} Default classification
             */
            getDefaultClassification() {
                return {
                    anaTur: 'sarf',
                    tip: 'Genel',
                    confidence: 0.50
                };
            }

            /**
             * Simulate AI processing with realistic delay and feedback
             * @param {string} materialName - Name of the material to classify
             * @param {Function} onProgress - Progress callback function
             * @returns {Promise} Classification result after processing
             */
            async classifyWithAI(materialName, onProgress = null) {
                const startTime = Date.now();
                const delay = this.processingDelay.min + 
                             Math.random() * (this.processingDelay.max - this.processingDelay.min);

                return new Promise((resolve) => {
                    // Simulate processing steps
                    const steps = [
                        { message: 'Malzeme adƒ± analiz ediliyor...', progress: 25 },
                        { message: 'Kategori kalƒ±plarƒ± e≈üle≈ütiriliyor...', progress: 50 },
                        { message: 'AI sƒ±nƒ±flandƒ±rma yapƒ±lƒ±yor...', progress: 75 },
                        { message: 'Sonu√ß hazƒ±rlanƒ±yor...', progress: 100 }
                    ];

                    let currentStep = 0;
                    const stepInterval = delay / steps.length;

                    const processStep = () => {
                        if (currentStep < steps.length) {
                            if (onProgress) {
                                onProgress(steps[currentStep]);
                            }
                            currentStep++;
                            setTimeout(processStep, stepInterval);
                        } else {
                            const result = this.classify(materialName);
                            const processingTime = Date.now() - startTime;
                            
                            resolve({
                                ...result,
                                processingTime,
                                timestamp: new Date().toISOString()
                            });
                        }
                    };

                    processStep();
                });
            }

            /**
             * Batch classify multiple materials
             * @param {Array} materialNames - Array of material names
             * @returns {Promise} Array of classification results
             */
            async batchClassify(materialNames) {
                const results = [];
                
                for (const name of materialNames) {
                    const result = await this.classifyWithAI(name);
                    results.push({
                        materialName: name,
                        ...result
                    });
                }
                
                return results;
            }

            /**
             * Get classification statistics
             * @returns {Object} Statistics about classification rules
             */
            getStatistics() {
                const rules = Object.values(this.classificationRules);
                const categories = {};
                const types = {};

                rules.forEach(rule => {
                    categories[rule.anaTur] = (categories[rule.anaTur] || 0) + 1;
                    types[rule.tip] = (types[rule.tip] || 0) + 1;
                });

                return {
                    totalRules: rules.length,
                    categories,
                    types,
                    averageConfidence: rules.reduce((sum, rule) => sum + rule.confidence, 0) / rules.length
                };
            }
        }

        /**
         * SOF NUMBER GENERATOR SYSTEM
         * Generates unique SOF (Satƒ±n Alma Onay Formu) numbers with proper prefixes
         * Maintains global counter with localStorage persistence
         */
        class SOFGenerator {
            constructor() {
                this.counterKey = 'somtech_sof_counter';
                this.historyKey = 'somtech_sof_history';
                this.loadCounter();
                this.loadHistory();
            }

            /**
             * Load counter from localStorage or initialize
             */
            loadCounter() {
                const saved = localStorage.getItem(this.counterKey);
                this.counter = saved ? parseInt(saved, 10) : 1;
                
                // Ensure counter is valid
                if (isNaN(this.counter) || this.counter < 1) {
                    this.counter = 1;
                }
            }

            /**
             * Save counter to localStorage
             */
            saveCounter() {
                localStorage.setItem(this.counterKey, this.counter.toString());
            }

            /**
             * Load SOF generation history
             */
            loadHistory() {
                try {
                    const saved = localStorage.getItem(this.historyKey);
                    this.history = saved ? JSON.parse(saved) : [];
                } catch (error) {
                    console.warn('SOF history load error:', error);
                    this.history = [];
                }
            }

            /**
             * Save SOF generation history
             */
            saveHistory() {
                try {
                    localStorage.setItem(this.historyKey, JSON.stringify(this.history));
                } catch (error) {
                    console.warn('SOF history save error:', error);
                }
            }

            /**
             * Generate SOF number based on material type
             * @param {string} anaTur - Material type ('sarf' or 'demirbas')
             * @param {Object} metadata - Additional metadata for the SOF
             * @returns {string} Generated SOF number
             */
            generateSOF(anaTur, metadata = {}) {
                const year = new Date().getFullYear();
                const prefix = anaTur === 'sarf' ? 'SMT-SOFS' : 'SMT-SOFD';
                const number = this.counter.toString().padStart(4, '0');
                const sofNumber = `${prefix}-${year}-${number}`;

                // Record in history
                const historyEntry = {
                    sofNumber,
                    anaTur,
                    prefix,
                    counter: this.counter,
                    year,
                    timestamp: new Date().toISOString(),
                    metadata
                };

                this.history.push(historyEntry);
                
                // Increment counter and save
                this.counter++;
                this.saveCounter();
                this.saveHistory();

                return sofNumber;
            }

            /**
             * Generate multiple SOF numbers for batch operations
             * @param {Array} materials - Array of materials with anaTur
             * @returns {Array} Array of generated SOF numbers
             */
            generateBatchSOF(materials) {
                const results = [];
                
                materials.forEach(material => {
                    const sofNumber = this.generateSOF(material.anaTur, {
                        materialName: material.name,
                        tip: material.tip,
                        batchId: Date.now()
                    });
                    
                    results.push({
                        ...material,
                        sofNumber
                    });
                });

                return results;
            }

            /**
             * Get SOF generation statistics
             * @returns {Object} Statistics about generated SOFs
             */
            getStatistics() {
                const sarfCount = this.history.filter(entry => entry.anaTur === 'sarf').length;
                const demirbasCount = this.history.filter(entry => entry.anaTur === 'demirbas').length;
                const currentYear = new Date().getFullYear();
                const thisYearCount = this.history.filter(entry => entry.year === currentYear).length;

                return {
                    totalGenerated: this.history.length,
                    sarfCount,
                    demirbasCount,
                    thisYearCount,
                    nextNumber: this.counter,
                    lastGenerated: this.history.length > 0 ? this.history[this.history.length - 1] : null
                };
            }

            /**
             * Search SOF history
             * @param {string} query - Search query
             * @returns {Array} Matching SOF entries
             */
            searchHistory(query) {
                if (!query) return this.history;

                const searchTerm = query.toLowerCase();
                return this.history.filter(entry => 
                    entry.sofNumber.toLowerCase().includes(searchTerm) ||
                    entry.metadata?.materialName?.toLowerCase().includes(searchTerm) ||
                    entry.metadata?.tip?.toLowerCase().includes(searchTerm)
                );
            }

            /**
             * Reset counter (admin function)
             * @param {number} newCounter - New counter value
             */
            resetCounter(newCounter = 1) {
                this.counter = Math.max(1, parseInt(newCounter, 10));
                this.saveCounter();
                
                // Log reset action
                this.history.push({
                    action: 'COUNTER_RESET',
                    oldCounter: this.counter,
                    newCounter,
                    timestamp: new Date().toISOString()
                });
                
                this.saveHistory();
            }

            /**
             * Export SOF history for backup
             * @returns {string} JSON string of history
             */
            exportHistory() {
                return JSON.stringify({
                    counter: this.counter,
                    history: this.history,
                    exportDate: new Date().toISOString(),
                    version: '1.9.8'
                }, null, 2);
            }
        }

        // Initialize AI and SOF systems
        const aiClassifier = new AIClassifier();
        const sofGenerator = new SOFGenerator();

        // ===== SOF NUMBER GENERATOR =====
        /**
         * SOF (Satƒ±n Alma Onay Formu) number generator
         * Generates unique SOF numbers with prefixes based on material type
         */
        class SOFGenerator {
            constructor() {
                this.loadCounter();
            }

            loadCounter() {
                const saved = localStorage.getItem('sof_counter');
                this.counter = saved ? parseInt(saved) : 1;
            }

            saveCounter() {
                localStorage.setItem('sof_counter', this.counter.toString());
            }

            /**
             * Generate SOF number based on material type
             * @param {string} anaTur - Material type (sarf or demirbas)
             * @returns {string} Generated SOF number
             */
            generateSOF(anaTur) {
                const year = new Date().getFullYear();
                const prefix = anaTur === 'sarf' ? 'SMT-SOFS' : 'SMT-SOFD';
                const number = this.counter.toString().padStart(4, '0');
                
                this.counter++;
                this.saveCounter();
                
                return `${prefix}-${year}-${number}`;
            }
        }

        // Initialize SOF generator
        const sofGenerator = new SOFGenerator();

        // ===== MATERIAL ROW MANAGEMENT =====
        /**
         * Manages dynamic material rows in the AI request form
         * Handles adding, removing, and validating material entries
         */
        class MaterialRowManager {
            constructor() {
                this.rowCounter = 0;
                this.container = document.getElementById('materials-container');
                this.addFirstRow();
            }

            addFirstRow() {
                this.addRow();
            }

            /**
             * Add a new material row to the form
             * @returns {HTMLElement} The newly created row element
             */
            addRow() {
                this.rowCounter++;
                const rowId = `material-row-${this.rowCounter}`;
                
                const rowHTML = `
                    <div class="material-row" id="${rowId}">
                        <div class="form-group">
                            <label class="form-label">Malzeme Adƒ±</label>
                            <input type="text" class="form-input material-name" placeholder="Malzeme adƒ±nƒ± girin" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                T√ºr <span class="ai-badge">AI</span>
                            </label>
                            <select class="form-select material-tur" required>
                                <option value="">AI tespit ediyor...</option>
                                <option value="sarf">Sarf</option>
                                <option value="demirbas">Demirba≈ü</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                Tip <span class="ai-badge">AI</span>
                            </label>
                            <select class="form-select material-tip" required>
                                <option value="">AI tespit ediyor...</option>
                                <option value="Bilgisayar Ekipmanƒ±">Bilgisayar Ekipmanƒ±</option>
                                <option value="Elektrik">Elektrik</option>
                                <option value="Mekanik">Mekanik</option>
                                <option value="Mobilya">Mobilya</option>
                                <option value="Kƒ±rtasiye">Kƒ±rtasiye</option>
                                <option value="Yapƒ± Malzemesi">Yapƒ± Malzemesi</option>
                                <option value="El Aletleri">El Aletleri</option>
                                <option value="Genel">Genel</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Birim</label>
                            <select class="form-select material-birim" required>
                                <option value="">Se√ßiniz</option>
                                <option value="adet">Adet</option>
                                <option value="kg">Kilogram</option>
                                <option value="metre">Metre</option>
                                <option value="litre">Litre</option>
                                <option value="paket">Paket</option>
                                <option value="kutu">Kutu</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Adet</label>
                            <input type="number" class="form-input material-adet" placeholder="Miktar" min="1" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Termin</label>
                            <input type="date" class="form-input material-termin" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Link</label>
                            <input type="url" class="form-input material-link" placeholder="https://...">
                        </div>
                        <button type="button" class="remove-material-btn" title="Satƒ±rƒ± Sil">üóëÔ∏è</button>
                    </div>
                `;
                
                this.container.insertAdjacentHTML('beforeend', rowHTML);
                
                // Add event listeners to the new row
                const newRow = document.getElementById(rowId);
                this.attachRowEventListeners(newRow);
                
                // Update remove button visibility
                this.updateRemoveButtons();
                
                return newRow;
            }

            /**
             * Attach event listeners to a material row
             * @param {HTMLElement} row - The row element to attach listeners to
             */
            attachRowEventListeners(row) {
                const materialNameInput = row.querySelector('.material-name');
                const removeBtn = row.querySelector('.remove-material-btn');
                
                // AI classification on material name input
                let classificationTimeout;
                materialNameInput.addEventListener('input', (e) => {
                    clearTimeout(classificationTimeout);
                    const value = e.target.value.trim();
                    
                    if (value.length >= 3) {
                        classificationTimeout = setTimeout(() => {
                            this.performAIClassification(row, value);
                        }, 500);
                    }
                });
                
                // Remove row functionality
                removeBtn.addEventListener('click', () => {
                    this.removeRow(row);
                });
            }

            /**
             * Perform AI classification for a material
             * @param {HTMLElement} row - The row containing the material
             * @param {string} materialName - Name of the material to classify
             */
            async performAIClassification(row, materialName) {
                const turSelect = row.querySelector('.material-tur');
                const tipSelect = row.querySelector('.material-tip');
                const aiStatus = document.getElementById('ai-status');
                
                // Show AI processing status
                aiStatus.style.display = 'block';
                turSelect.disabled = true;
                tipSelect.disabled = true;
                
                try {
                    // Perform AI classification
                    const classification = await aiClassifier.classifyWithDelay(materialName);
                    
                    // Update the select elements
                    turSelect.value = classification.anaTur;
                    tipSelect.value = classification.tip;
                    
                    // Show success feedback
                    toast.show(`AI: "${materialName}" ‚Üí ${classification.tip} (${classification.anaTur})`, 'success', 3000);
                    
                } catch (error) {
                    console.error('AI Classification error:', error);
                    toast.show('AI sƒ±nƒ±flandƒ±rma hatasƒ±', 'error');
                } finally {
                    // Hide AI processing status
                    aiStatus.style.display = 'none';
                    turSelect.disabled = false;
                    tipSelect.disabled = false;
                }
            }

            /**
             * Remove a material row
             * @param {HTMLElement} row - The row to remove
             */
            removeRow(row) {
                const rows = this.container.querySelectorAll('.material-row');
                if (rows.length > 1) {
                    row.remove();
                    this.updateRemoveButtons();
                    toast.show('Malzeme satƒ±rƒ± silindi', 'info');
                } else {
                    toast.show('En az bir malzeme satƒ±rƒ± olmalƒ±dƒ±r', 'warning');
                }
            }

            /**
             * Update visibility of remove buttons based on row count
             */
            updateRemoveButtons() {
                const rows = this.container.querySelectorAll('.material-row');
                const removeButtons = this.container.querySelectorAll('.remove-material-btn');
                
                removeButtons.forEach(btn => {
                    btn.style.display = rows.length > 1 ? 'flex' : 'none';
                });
            }

            /**
             * Get all valid materials from the form
             * @returns {Array} Array of material objects
             */
            getAllMaterials() {
                const materials = [];
                const rows = this.container.querySelectorAll('.material-row');
                
                rows.forEach(row => {
                    const material = {
                        name: row.querySelector('.material-name').value.trim(),
                        tur: row.querySelector('.material-tur').value,
                        tip: row.querySelector('.material-tip').value,
                        birim: row.querySelector('.material-birim').value,
                        adet: parseInt(row.querySelector('.material-adet').value) || 0,
                        termin: row.querySelector('.material-termin').value,
                        link: row.querySelector('.material-link').value.trim()
                    };
                    
                    if (material.name && material.tur && material.tip && material.birim && material.adet > 0 && material.termin) {
                        materials.push(material);
                    }
                });
                
                return materials;
            }

            /**
             * Reset the form to initial state
             */
            reset() {
                this.container.innerHTML = '';
                this.rowCounter = 0;
                this.addFirstRow();
            }
        }

        // ===== REQUEST MANAGEMENT SYSTEM =====
        /**
         * Manages request creation and storage
         * Handles user information and request persistence
         */
        class RequestManager {
            constructor() {
                this.loadUserInfo();
            }

            /**
             * Load user information from localStorage
             */
            loadUserInfo() {
                // Load user department from localStorage or set default
                const savedBirim = localStorage.getItem('user_birim') || 'Bilgi ƒ∞≈ülem';
                const birimInput = document.getElementById('ai-birim');
                if (birimInput) {
                    birimInput.value = savedBirim;
                }
            }

            /**
             * Save request to localStorage
             * @param {Object} userData - User information
             * @param {Array} materials - Array of materials
             * @returns {Array} Array of saved requests with SOF numbers
             */
            saveRequest(userData, materials) {
                try {
                    // Generate SOF numbers for each material
                    const requests = materials.map(material => ({
                        sofNo: sofGenerator.generateSOF(material.tur),
                        talepTarihi: new Date().toISOString().split('T')[0],
                        birim: userData.birim,
                        adiSoyadi: userData.adiSoyadi,
                        malzeme: material.name,
                        tur: material.tur,
                        tip: material.tip,
                        birim_olcu: material.birim,
                        adet: material.adet,
                        termin: material.termin,
                        link: material.link,
                        durum: 'Beklemede',
                        olusturmaTarihi: new Date().toISOString()
                    }));

                    // Save to localStorage
                    const existingRequests = JSON.parse(localStorage.getItem('sof_requests') || '[]');
                    const updatedRequests = [...existingRequests, ...requests];
                    localStorage.setItem('sof_requests', JSON.stringify(updatedRequests));

                    // Save user info
                    localStorage.setItem('user_birim', userData.birim);
                    localStorage.setItem('user_name', userData.adiSoyadi);

                    return requests;
                } catch (error) {
                    console.error('Request save error:', error);
                    throw new Error('Talep kaydedilemedi');
                }
            }
        }

        // Initialize request manager
        const requestManager = new RequestManager();

        // ===== THEME MANAGEMENT =====
        /**
         * Theme toggle functionality with localStorage persistence
         */
        const themeToggle = document.getElementById('theme-toggle');
        const body = document.body;
        let currentTheme = 'dark'; // Default to dark theme

        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            body.setAttribute('data-theme', currentTheme);
            localStorage.setItem('theme', currentTheme);
            toast.show(`${currentTheme === 'dark' ? 'Karanlƒ±k' : 'Aydƒ±nlƒ±k'} tema aktif`, 'info', 2000);
        }

        // Load saved theme
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            currentTheme = savedTheme;
            body.setAttribute('data-theme', currentTheme);
        }

        themeToggle.addEventListener('click', toggleTheme);

        // ===== LANGUAGE MANAGEMENT =====
        /**
         * Multi-language support with i18n dictionary
         */
        const i18nDictionary = {
            tr: {
                overview: '√ñzet',
                records: 'Kayƒ±t Tablosu',
                reportForm: 'Rapor Formu',
                reports: 'Raporlar',
                settings: 'Ayarlar',
                newRequest: 'Yeni Talep Olu≈ütur'
            },
            en: {
                overview: 'Overview',
                records: 'Records Table',
                reportForm: 'Report Form',
                reports: 'Reports',
                settings: 'Settings',
                newRequest: 'Create New Request'
            },
            ru: {
                overview: '–û–±–∑–æ—Ä',
                records: '–¢–∞–±–ª–∏—Ü–∞ –∑–∞–ø–∏—Å–µ–π',
                reportForm: '–§–æ—Ä–º–∞ –æ—Ç—á–µ—Ç–∞',
                reports: '–û—Ç—á–µ—Ç—ã',
                settings: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏',
                newRequest: '–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å'
            }
        };

        let currentLanguage = 'tr';

        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('language', lang);
            
            // Update navigation texts
            const texts = i18nDictionary[lang];
            document.getElementById('nav-overview').textContent = texts.overview;
            document.getElementById('nav-records').textContent = texts.records;
            document.getElementById('nav-report-form').textContent = texts.reportForm;
            document.getElementById('nav-reports').textContent = texts.reports;
            document.getElementById('nav-settings').textContent = texts.settings;
            document.getElementById('nav-new-request').textContent = texts.newRequest;
            
            toast.show(`Dil deƒüi≈ütirildi: ${lang.toUpperCase()}`, 'info', 2000);
        }

        // Load saved language
        const savedLanguage = localStorage.getItem('language');
        if (savedLanguage && i18nDictionary[savedLanguage]) {
            changeLanguage(savedLanguage);
            document.getElementById('language-select').value = savedLanguage;
        }

        document.getElementById('language-select').addEventListener('change', (e) => {
            changeLanguage(e.target.value);
        });

        // ===== USER ROLE MANAGEMENT =====
        /**
         * User role management with localStorage persistence
         */
        let currentRole = 'birim-kullanicisi';

        function changeRole(role) {
            currentRole = role;
            localStorage.setItem('user_role', role);
            
            const roleNames = {
                'satin-alma': 'Satƒ±n Alma',
                'muhasebe': 'Muhasebe',
                'mudur': 'M√ºd√ºr',
                'birim-kullanicisi': 'Birim Kullanƒ±cƒ±sƒ±'
            };
            
            toast.show(`Rol deƒüi≈ütirildi: ${roleNames[role]}`, 'info', 2000);
        }

        // Load saved role
        const savedRole = localStorage.getItem('user_role');
        if (savedRole) {
            currentRole = savedRole;
            document.getElementById('role-select').value = savedRole;
        }

        document.getElementById('role-select').addEventListener('change', (e) => {
            changeRole(e.target.value);
        });

        // ===== AI REQUEST MODAL MANAGEMENT =====
        let materialRowManager;

        // Modal elements
        const aiRequestModal = document.getElementById('ai-request-modal');
        const openAIRequestBtns = document.querySelectorAll('#open-ai-request-modal, #open-ai-request-modal-alt');
        const closeAIRequestBtn = document.getElementById('close-ai-request');
        const cancelAIRequestBtn = document.getElementById('cancel-ai-request');
        const saveAIRequestBtn = document.getElementById('save-ai-request');
        const addMaterialRowBtn = document.getElementById('add-material-row');

        // Open AI request modal
        openAIRequestBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                openModal(aiRequestModal);
                if (!materialRowManager) {
                    materialRowManager = new MaterialRowManager();
                }
            });
        });

        // Close AI request modal
        [closeAIRequestBtn, cancelAIRequestBtn].forEach(btn => {
            if (btn) {
                btn.addEventListener('click', () => {
                    closeModal(aiRequestModal);
                });
            }
        });

        // Add material row
        if (addMaterialRowBtn) {
            addMaterialRowBtn.addEventListener('click', () => {
                if (materialRowManager) {
                    materialRowManager.addRow();
                    toast.show('Yeni malzeme satƒ±rƒ± eklendi', 'success');
                }
            });
        }

        // Save AI request
        if (saveAIRequestBtn) {
            saveAIRequestBtn.addEventListener('click', async () => {
                try {
                    // Get user data
                    const birim = document.getElementById('ai-birim').value.trim();
                    const adiSoyadi = document.getElementById('ai-adi-soyadi').value.trim();

                    if (!birim || !adiSoyadi) {
                        toast.show('L√ºtfen t√ºm kullanƒ±cƒ± bilgilerini doldurun', 'warning');
                        return;
                    }

                    // Get materials data
                    const materials = materialRowManager.getAllMaterials();
                    
                    if (materials.length === 0) {
                        toast.show('L√ºtfen en az bir malzeme ekleyin', 'warning');
                        return;
                    }

                    // Show loading state
                    saveAIRequestBtn.innerHTML = 'üíæ Kaydediliyor...';
                    saveAIRequestBtn.disabled = true;

                    // Save request
                    const savedRequests = requestManager.saveRequest(
                        { birim, adiSoyadi },
                        materials
                    );

                    // Show success
                    saveAIRequestBtn.innerHTML = '‚úÖ Kaydedildi!';
                    
                    setTimeout(() => {
                        closeModal(aiRequestModal);
                        materialRowManager.reset();
                        document.getElementById('ai-adi-soyadi').value = '';
                        
                        // Reset button
                        saveAIRequestBtn.innerHTML = 'üíæ Talebi Kaydet';
                        saveAIRequestBtn.disabled = false;
                        
                        // Show success message
                        toast.show(`${savedRequests.length} malzeme talebi ba≈üarƒ±yla kaydedildi`, 'success', 5000);
                        
                        // Update records view if active
                        updateRecordsTable();
                        
                    }, 1500);

                } catch (error) {
                    console.error('Save request error:', error);
                    toast.show('Talep kaydedilemedi: ' + error.message, 'error');
                    
                    // Reset button
                    saveAIRequestBtn.innerHTML = 'üíæ Talebi Kaydet';
                    saveAIRequestBtn.disabled = false;
                }
            });
        }

        // ===== DATA MANAGEMENT SYSTEM =====
        /**
         * DATA STORAGE AND RETRIEVAL SYSTEM
         * Manages localStorage operations for material requests and system data
         * Provides CRUD operations with error handling and data validation
         */
        class DataManager {
            constructor() {
                this.storageKeys = {
                    requests: 'somtech_sof_requests',
                    users: 'somtech_users',
                    settings: 'somtech_settings',
                    backup: 'somtech_backup'
                };
                this.initializeStorage();
            }

            /**
             * Initialize storage with default data if empty
             */
            initializeStorage() {
                // Initialize requests storage if empty
                if (!localStorage.getItem(this.storageKeys.requests)) {
                    this.saveRequests([]);
                }

                // Initialize users storage
                if (!localStorage.getItem(this.storageKeys.users)) {
                    this.saveUsers([]);
                }

                // Initialize settings
                if (!localStorage.getItem(this.storageKeys.settings)) {
                    this.saveSettings({
                        defaultBirim: 'Bilgi ƒ∞≈ülem',
                        autoSave: true,
                        notifications: true
                    });
                }
            }

            /**
             * Get all requests from localStorage
             * @returns {Array} Array of request objects
             */
            getRequests() {
                try {
                    const data = localStorage.getItem(this.storageKeys.requests);
                    return data ? JSON.parse(data) : [];
                } catch (error) {
                    console.error('Error loading requests:', error);
                    return [];
                }
            }

            /**
             * Save requests to localStorage
             * @param {Array} requests - Array of request objects
             */
            saveRequests(requests) {
                try {
                    localStorage.setItem(this.storageKeys.requests, JSON.stringify(requests));
                    return true;
                } catch (error) {
                    console.error('Error saving requests:', error);
                    return false;
                }
            }

            /**
             * Add new request to storage
             * @param {Object} request - Request object to add
             * @returns {boolean} Success status
             */
            addRequest(request) {
                try {
                    const requests = this.getRequests();
                    const newRequest = {
                        id: Date.now().toString(),
                        createdAt: new Date().toISOString(),
                        ...request
                    };
                    requests.push(newRequest);
                    return this.saveRequests(requests);
                } catch (error) {
                    console.error('Error adding request:', error);
                    return false;
                }
            }

            /**
             * Update existing request
             * @param {string} id - Request ID
             * @param {Object} updates - Updates to apply
             * @returns {boolean} Success status
             */
            updateRequest(id, updates) {
                try {
                    const requests = this.getRequests();
                    const index = requests.findIndex(r => r.id === id);
                    
                    if (index !== -1) {
                        requests[index] = {
                            ...requests[index],
                            ...updates,
                            updatedAt: new Date().toISOString()
                        };
                        return this.saveRequests(requests);
                    }
                    return false;
                } catch (error) {
                    console.error('Error updating request:', error);
                    return false;
                }
            }

            /**
             * Delete request by ID
             * @param {string} id - Request ID to delete
             * @returns {boolean} Success status
             */
            deleteRequest(id) {
                try {
                    const requests = this.getRequests();
                    const filtered = requests.filter(r => r.id !== id);
                    return this.saveRequests(filtered);
                } catch (error) {
                    console.error('Error deleting request:', error);
                    return false;
                }
            }

            /**
             * Search requests by query
             * @param {string} query - Search query
             * @returns {Array} Filtered requests
             */
            searchRequests(query) {
                const requests = this.getRequests();
                if (!query) return requests;

                const searchTerm = query.toLowerCase();
                return requests.filter(request => 
                    request.sofNo?.toLowerCase().includes(searchTerm) ||
                    request.malzeme?.toLowerCase().includes(searchTerm) ||
                    request.adiSoyadi?.toLowerCase().includes(searchTerm) ||
                    request.tip?.toLowerCase().includes(searchTerm) ||
                    request.birim?.toLowerCase().includes(searchTerm)
                );
            }

            /**
             * Get requests statistics
             * @returns {Object} Statistics object
             */
            getStatistics() {
                const requests = this.getRequests();
                const sarfCount = requests.filter(r => r.tur === 'sarf').length;
                const demirbasCount = requests.filter(r => r.tur === 'demirbas').length;
                
                const statusCounts = {};
                requests.forEach(r => {
                    statusCounts[r.durum] = (statusCounts[r.durum] || 0) + 1;
                });

                return {
                    total: requests.length,
                    sarf: sarfCount,
                    demirbas: demirbasCount,
                    statusCounts,
                    lastUpdated: new Date().toISOString()
                };
            }

            /**
             * Export data for backup
             * @returns {Object} Export data
             */
            exportData() {
                return {
                    requests: this.getRequests(),
                    users: this.getUsers(),
                    settings: this.getSettings(),
                    sofStats: sofGenerator.getStatistics(),
                    exportDate: new Date().toISOString(),
                    version: '1.9.8'
                };
            }

            /**
             * Import data from backup
             * @param {Object} data - Import data
             * @returns {boolean} Success status
             */
            importData(data) {
                try {
                    if (data.requests) this.saveRequests(data.requests);
                    if (data.users) this.saveUsers(data.users);
                    if (data.settings) this.saveSettings(data.settings);
                    return true;
                } catch (error) {
                    console.error('Error importing data:', error);
                    return false;
                }
            }

            /**
             * Get users from localStorage
             * @returns {Array} Array of user objects
             */
            getUsers() {
                try {
                    const data = localStorage.getItem(this.storageKeys.users);
                    return data ? JSON.parse(data) : [];
                } catch (error) {
                    console.error('Error loading users:', error);
                    return [];
                }
            }

            /**
             * Save users to localStorage
             * @param {Array} users - Array of user objects
             */
            saveUsers(users) {
                try {
                    localStorage.setItem(this.storageKeys.users, JSON.stringify(users));
                    return true;
                } catch (error) {
                    console.error('Error saving users:', error);
                    return false;
                }
            }

            /**
             * Get settings from localStorage
             * @returns {Object} Settings object
             */
            getSettings() {
                try {
                    const data = localStorage.getItem(this.storageKeys.settings);
                    return data ? JSON.parse(data) : {};
                } catch (error) {
                    console.error('Error loading settings:', error);
                    return {};
                }
            }

            /**
             * Save settings to localStorage
             * @param {Object} settings - Settings object
             */
            saveSettings(settings) {
                try {
                    localStorage.setItem(this.storageKeys.settings, JSON.stringify(settings));
                    return true;
                } catch (error) {
                    console.error('Error saving settings:', error);
                    return false;
                }
            }
        }

        /**
         * TABLE RENDERING AND MANAGEMENT SYSTEM
         * Handles dynamic table rendering, sorting, filtering, and pagination
         * Provides real-time updates from localStorage data
         */
        class TableManager {
            constructor(dataManager) {
                this.dataManager = dataManager;
                this.currentSort = { column: null, direction: 'asc' };
                this.currentFilter = { status: 'all', type: 'all' };
                this.itemsPerPage = 50;
                this.currentPage = 1;
                this.initializeTable();
            }

            /**
             * Initialize table with event listeners
             */
            initializeTable() {
                this.bindEvents();
                this.renderTable();
            }

            /**
             * Bind event listeners for table interactions
             */
            bindEvents() {
                // Search functionality
                const searchInput = document.getElementById('search-input');
                if (searchInput) {
                    let searchTimeout;
                    searchInput.addEventListener('input', (e) => {
                        clearTimeout(searchTimeout);
                        searchTimeout = setTimeout(() => {
                            this.handleSearch(e.target.value);
                        }, 300);
                    });
                }

                // Filter buttons
                const filterBtn = document.getElementById('filter-btn');
                if (filterBtn) {
                    filterBtn.addEventListener('click', () => this.showFilterModal());
                }

                // Export button
                const exportBtn = document.getElementById('export-btn');
                if (exportBtn) {
                    exportBtn.addEventListener('click', () => this.exportTable());
                }
            }

            /**
             * Render the complete table with current data
             */
            renderTable() {
                const tbody = document.getElementById('records-tbody');
                if (!tbody) return;

                try {
                    const requests = this.dataManager.getRequests();
                    
                    // Clear existing content
                    tbody.innerHTML = '';

                    if (requests.length === 0) {
                        this.renderEmptyState(tbody);
                        return;
                    }

                    // Apply filters and sorting
                    const filteredData = this.applyFilters(requests);
                    const sortedData = this.applySorting(filteredData);
                    const paginatedData = this.applyPagination(sortedData);

                    // Render rows
                    paginatedData.forEach(request => {
                        const row = this.createTableRow(request);
                        tbody.appendChild(row);
                    });

                    // Update summary counts
                    this.updateSummaryCounts(requests);

                    // Update pagination info
                    this.updatePaginationInfo(filteredData.length);

                } catch (error) {
                    console.error('Table render error:', error);
                    toast.show('Tablo y√ºklenirken hata olu≈ütu', 'error');
                }
            }

            /**
             * Create a table row element for a request
             * @param {Object} request - Request data
             * @returns {HTMLElement} Table row element
             */
            createTableRow(request) {
                const row = document.createElement('tr');
                row.setAttribute('data-request-id', request.id || '');
                
                row.innerHTML = `
                    <td><strong>${request.sofNo || 'N/A'}</strong></td>
                    <td class="secondary-text">${this.formatDate(request.talepTarihi)}</td>
                    <td>${request.malzeme || 'N/A'}</td>
                    <td class="secondary-text">${request.birim_olcu || 'N/A'}</td>
                    <td><span class="status-tag ${request.tur || 'sarf'}">${this.formatType(request.tur)}</span></td>
                    <td class="secondary-text">${request.tip || 'N/A'}</td>
                    <td><strong>${request.adet || 0}</strong></td>
                    <td class="secondary-text">${this.formatDate(request.termin)}</td>
                    <td>${request.adiSoyadi || 'N/A'}</td>
                    <td>${this.formatLink(request.link)}</td>
                    <td><span class="status-tag ${this.getStatusClass(request.durum)}">${request.durum || 'Beklemede'}</span></td>
                    <td>
                        <button class="action-button edit" onclick="tableManager.editRequest('${request.id}')">D√ºzenle</button>
                        <button class="action-button delete" onclick="tableManager.deleteRequest('${request.id}')">Sil</button>
                    </td>
                `;

                return row;
            }

            /**
             * Render empty state when no data available
             * @param {HTMLElement} tbody - Table body element
             */
            renderEmptyState(tbody) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="12" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <div style="font-size: 48px; margin-bottom: 16px;">üìã</div>
                        <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">Hen√ºz kayƒ±t bulunmuyor</div>
                        <div style="font-size: 14px;">Yeni bir talep olu≈üturmak i√ßin "+" butonunu kullanƒ±n</div>
                    </td>
                `;
                tbody.appendChild(row);

                // Reset summary counts
                this.updateSummaryCounts([]);
            }

            /**
             * Apply filters to data
             * @param {Array} data - Raw data array
             * @returns {Array} Filtered data
             */
            applyFilters(data) {
                let filtered = [...data];

                // Status filter
                if (this.currentFilter.status !== 'all') {
                    filtered = filtered.filter(item => item.durum === this.currentFilter.status);
                }

                // Type filter
                if (this.currentFilter.type !== 'all') {
                    filtered = filtered.filter(item => item.tur === this.currentFilter.type);
                }

                return filtered;
            }

            /**
             * Apply sorting to data
             * @param {Array} data - Data to sort
             * @returns {Array} Sorted data
             */
            applySorting(data) {
                if (!this.currentSort.column) return data;

                return [...data].sort((a, b) => {
                    const aVal = a[this.currentSort.column] || '';
                    const bVal = b[this.currentSort.column] || '';
                    
                    const comparison = aVal.toString().localeCompare(bVal.toString(), 'tr');
                    return this.currentSort.direction === 'asc' ? comparison : -comparison;
                });
            }

            /**
             * Apply pagination to data
             * @param {Array} data - Data to paginate
             * @returns {Array} Paginated data
             */
            applyPagination(data) {
                const startIndex = (this.currentPage - 1) * this.itemsPerPage;
                const endIndex = startIndex + this.itemsPerPage;
                return data.slice(startIndex, endIndex);
            }

            /**
             * Handle search functionality
             * @param {string} query - Search query
             */
            handleSearch(query) {
                // This would typically update a search filter
                // For now, we'll implement a simple client-side search
                const tbody = document.getElementById('records-tbody');
                if (!tbody) return;

                const rows = tbody.querySelectorAll('tr');
                const searchTerm = query.toLowerCase();

                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    const shouldShow = !query || text.includes(searchTerm);
                    row.style.display = shouldShow ? '' : 'none';
                });
            }

            /**
             * Format date for display
             * @param {string} dateString - ISO date string
             * @returns {string} Formatted date
             */
            formatDate(dateString) {
                if (!dateString) return 'N/A';
                try {
                    const date = new Date(dateString);
                    return date.toLocaleDateString('tr-TR');
                } catch (error) {
                    return 'N/A';
                }
            }

            /**
             * Format material type for display
             * @param {string} type - Material type
             * @returns {string} Formatted type
             */
            formatType(type) {
                const typeMap = {
                    'sarf': 'Sarf',
                    'demirbas': 'Demirba≈ü'
                };
                return typeMap[type] || 'N/A';
            }

            /**
             * Format link for display
             * @param {string} link - URL link
             * @returns {string} Formatted link HTML
             */
            formatLink(link) {
                if (link && link.startsWith('http')) {
                    return `<a href="${link}" class="link-button" target="_blank" rel="noopener noreferrer">Link</a>`;
                }
                return '<a href="#" class="link-button" onclick="tableManager.showDetails(this)">Detay</a>';
            }

            /**
             * Get CSS class for status
             * @param {string} status - Status string
             * @returns {string} CSS class name
             */
            getStatusClass(status) {
                const statusMap = {
                    'Beklemede': 'pending',
                    'Tamamlandƒ±': 'completed',
                    'ƒ∞ptal': 'cancelled',
                    'Onaylandƒ±': 'completed',
                    'Reddedildi': 'cancelled'
                };
                return statusMap[status] || 'pending';
            }

            /**
             * Update summary counts in overview
             * @param {Array} requests - Array of requests
             */
            updateSummaryCounts(requests) {
                const stats = {
                    sarf: requests.filter(r => r.tur === 'sarf').length,
                    demirbas: requests.filter(r => r.tur === 'demirbas').length,
                    total: requests.length
                };

                // Update summary cards
                const elements = {
                    sarf: document.getElementById('sarf-count'),
                    demirbas: document.getElementById('demirbas-count'),
                    total: document.getElementById('total-count')
                };

                Object.entries(elements).forEach(([key, element]) => {
                    if (element) {
                        element.textContent = stats[key];
                    }
                });
            }

            /**
             * Update pagination information
             * @param {number} totalItems - Total number of items
             */
            updatePaginationInfo(totalItems) {
                const totalPages = Math.ceil(totalItems / this.itemsPerPage);
                // This would update pagination controls if they exist
                console.log(`Page ${this.currentPage} of ${totalPages} (${totalItems} items)`);
            }

            /**
             * Edit request handler
             * @param {string} requestId - Request ID to edit
             */
            editRequest(requestId) {
                const requests = this.dataManager.getRequests();
                const request = requests.find(r => r.id === requestId);
                
                if (request) {
                    // This would open an edit modal
                    console.log('Edit request:', request);
                    toast.show('D√ºzenleme √∂zelliƒüi yakƒ±nda aktif olacak', 'info');
                }
            }

            /**
             * Delete request handler
             * @param {string} requestId - Request ID to delete
             */
            deleteRequest(requestId) {
                if (confirm('Bu kaydƒ± silmek istediƒüinizden emin misiniz?')) {
                    const success = this.dataManager.deleteRequest(requestId);
                    if (success) {
                        this.renderTable();
                        toast.show('Kayƒ±t ba≈üarƒ±yla silindi', 'success');
                    } else {
                        toast.show('Kayƒ±t silinirken hata olu≈ütu', 'error');
                    }
                }
            }

            /**
             * Show request details
             * @param {HTMLElement} element - Clicked element
             */
            showDetails(element) {
                const row = element.closest('tr');
                const requestId = row.getAttribute('data-request-id');
                
                if (requestId) {
                    // This would open a details modal
                    console.log('Show details for request:', requestId);
                    // For now, open the process tracking modal
                    const processModal = document.getElementById('process-modal');
                    if (processModal) {
                        processModal.classList.add('active');
                    }
                }
            }

            /**
             * Show filter modal
             */
            showFilterModal() {
                toast.show('Geli≈ümi≈ü filtre √∂zelliƒüi yakƒ±nda aktif olacak', 'info');
            }

            /**
             * Export table data
             */
            exportTable() {
                try {
                    const data = this.dataManager.exportData();
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `somtech_export_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    toast.show('Veriler ba≈üarƒ±yla dƒ±≈üa aktarƒ±ldƒ±', 'success');
                } catch (error) {
                    console.error('Export error:', error);
                    toast.show('Dƒ±≈üa aktarma sƒ±rasƒ±nda hata olu≈ütu', 'error');
                }
            }

            /**
             * Refresh table data
             */
            refresh() {
                this.renderTable();
            }
        }

        // Initialize data and table managers
        const dataManager = new DataManager();
        const tableManager = new TableManager(dataManager);

        // ===== NAVIGATION MANAGEMENT =====
        const navButtons = document.querySelectorAll('.nav-button');
        const pageViews = document.querySelectorAll('.page-view');
        
        function showPage(pageId) {
            // Hide all page views
            pageViews.forEach(view => view.classList.remove('active'));
            // Show selected page view
            const targetView = document.getElementById(pageId + '-view');
            if (targetView) {
                targetView.classList.add('active');
            }
        }
        
        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Remove active class from all buttons
                navButtons.forEach(btn => btn.classList.remove('active'));
                // Add active class to clicked button
                button.classList.add('active');
                
                // Show corresponding page
                const page = button.getAttribute('data-page');
                showPage(page);
            });
        });

        // ===== MODAL MANAGEMENT =====
        const modals = {
            newRecord: document.getElementById('new-record-modal'),
            process: document.getElementById('process-modal'),
            aiRequest: document.getElementById('ai-request-modal')
        };

        const modalTriggers = {
            addRecord: document.getElementById('add-record-btn'),
            closeNewRecord: document.getElementById('close-new-record'),
            cancelNewRecord: document.getElementById('cancel-new-record'),
            closeProcess: document.getElementById('close-process'),
            closeProcessFooter: document.getElementById('close-process-footer')
        };

        // Modal functions
        function openModal(modal) {
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeModal(modal) {
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        function closeAllModals() {
            Object.values(modals).forEach(modal => closeModal(modal));
        }

        // Add record button
        if (modalTriggers.addRecord) {
            modalTriggers.addRecord.addEventListener('click', () => {
                openModal(modals.newRecord);
            });
        }

        // Close buttons for new record modal
        if (modalTriggers.closeNewRecord) {
            modalTriggers.closeNewRecord.addEventListener('click', () => {
                closeModal(modals.newRecord);
            });
        }

        if (modalTriggers.cancelNewRecord) {
            modalTriggers.cancelNewRecord.addEventListener('click', () => {
                closeModal(modals.newRecord);
            });
        }

        // Close buttons for process modal
        if (modalTriggers.closeProcess) {
            modalTriggers.closeProcess.addEventListener('click', () => {
                closeModal(modals.process);
            });
        }

        if (modalTriggers.closeProcessFooter) {
            modalTriggers.closeProcessFooter.addEventListener('click', () => {
                closeModal(modals.process);
            });
        }

        // Close modal when clicking overlay
        Object.values(modals).forEach(modal => {
            if (modal) {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeModal(modal);
                    }
                });
            }
        });

        // Close modals with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeAllModals();
            }
        });

        // ===== FORM MANAGEMENT =====
        // Form submission for original new record modal
        const newRecordForm = document.getElementById('new-record-form');
        if (newRecordForm) {
            newRecordForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                // Get form data
                const formData = new FormData(newRecordForm);
                const data = Object.fromEntries(formData.entries());
                
                console.log('New record data:', data);
                
                // Show success feedback
                const submitBtn = newRecordForm.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '‚úÖ Kaydedildi!';
                submitBtn.disabled = true;
                
                setTimeout(() => {
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    closeModal(modals.newRecord);
                    newRecordForm.reset();
                    toast.show('Kayƒ±t ba≈üarƒ±yla eklendi', 'success');
                }, 1500);
            });
        }

        // ===== TABLE INTERACTIONS =====
        const searchInput = document.getElementById('search-input');
        const filterBtn = document.getElementById('filter-btn');
        const exportBtn = document.getElementById('export-btn');

        // Search functionality
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const tableRows = document.querySelectorAll('#records-tbody tr');
                
                tableRows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    if (text.includes(searchTerm)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            });
        }

        // Filter button
        if (filterBtn) {
            filterBtn.addEventListener('click', () => {
                toast.show('Filtre √∂zelliƒüi yakƒ±nda aktif olacak', 'info');
                // Add visual feedback
                filterBtn.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    filterBtn.style.transform = '';
                }, 150);
            });
        }

        // Export button
        if (exportBtn) {
            exportBtn.addEventListener('click', () => {
                toast.show('Dƒ±≈üa aktarma √∂zelliƒüi yakƒ±nda aktif olacak', 'info');
                // Add visual feedback
                exportBtn.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    exportBtn.style.transform = '';
                }, 150);
            });
        }

        // ===== OTHER INTERACTIONS =====
        // Notification button interaction
        const notificationBtn = document.getElementById('notifications');
        notificationBtn.addEventListener('click', () => {
            toast.show('Bildirimler yakƒ±nda aktif olacak', 'info');
            // Add pulse animation
            notificationBtn.style.animation = 'pulse 0.3s ease-in-out';
            setTimeout(() => {
                notificationBtn.style.animation = '';
            }, 300);
        });

        // Process tracking modal for detail links
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('link-button') && e.target.textContent === 'Detay') {
                e.preventDefault();
                openModal(modals.process);
            }
        });

        // Export timeline functionality
        const exportTimelineBtn = document.getElementById('export-timeline');
        if (exportTimelineBtn) {
            exportTimelineBtn.addEventListener('click', () => {
                console.log('Exporting timeline report...');
                
                // Add visual feedback
                const originalText = exportTimelineBtn.innerHTML;
                exportTimelineBtn.innerHTML = 'üìÑ ƒ∞ndiriliyor...';
                exportTimelineBtn.disabled = true;
                
                setTimeout(() => {
                    exportTimelineBtn.innerHTML = '‚úÖ ƒ∞ndirildi!';
                    toast.show('S√ºre√ß raporu indirildi', 'success');
                    setTimeout(() => {
                        exportTimelineBtn.innerHTML = originalText;
                        exportTimelineBtn.disabled = false;
                    }, 1000);
                }, 1500);
            });
        }

        // ===== SYSTEM INITIALIZATION =====
        /**
         * MAIN APPLICATION INITIALIZATION
         * Initializes all system components and sets up event handlers
         * Provides startup sequence and system readiness checks
         */
        class ApplicationInitializer {
            constructor() {
                this.initializationSteps = [
                    { name: 'Core Systems', handler: () => this.initializeCoreSystems() },
                    { name: 'User Interface', handler: () => this.initializeUI() },
                    { name: 'Event Handlers', handler: () => this.initializeEventHandlers() },
                    { name: 'Data Loading', handler: () => this.initializeData() },
                    { name: 'Final Setup', handler: () => this.finalizeBoot() }
                ];
                this.startInitialization();
            }

            /**
             * Start the initialization sequence
             */
            async startInitialization() {
                console.log('üöÄ SOMTECH_SOF v1.9.8 - System Initialization Started');
                
                try {
                    for (const step of this.initializationSteps) {
                        console.log(`‚è≥ Initializing: ${step.name}`);
                        await step.handler();
                        console.log(`‚úÖ Completed: ${step.name}`);
                    }
                    
                    this.onInitializationComplete();
                } catch (error) {
                    this.onInitializationError(error);
                }
            }

            /**
             * Initialize core system components
             */
            async initializeCoreSystems() {
                // Core systems are already initialized globally
                // Verify they're working correctly
                if (!toast || !themeManager || !i18n || !roleManager) {
                    throw new Error('Core systems failed to initialize');
                }

                if (!aiClassifier || !sofGenerator || !dataManager || !tableManager) {
                    throw new Error('Business logic systems failed to initialize');
                }

                // Apply saved preferences
                themeManager.applyTheme(themeManager.getCurrentTheme());
                i18n.applyLanguage(i18n.getCurrentLanguage());
                roleManager.applyRolePermissions(roleManager.getCurrentRole().code);
            }

            /**
             * Initialize user interface components
             */
            async initializeUI() {
                // Set default dates for form inputs
                this.setDefaultDates();
                
                // Initialize tooltips and help text
                this.initializeTooltips();
                
                // Set up responsive behavior
                this.initializeResponsive();
            }

            /**
             * Initialize event handlers and interactions
             */
            async initializeEventHandlers() {
                // Navigation system
                this.initializeNavigation();
                
                // Modal system
                this.initializeModals();
                
                // Form handlers
                this.initializeForms();
                
                // Keyboard shortcuts
                this.initializeKeyboardShortcuts();
            }

            /**
             * Initialize data loading and table rendering
             */
            async initializeData() {
                // Load and render initial data
                tableManager.refresh();
                
                // Set up auto-refresh if needed
                this.setupAutoRefresh();
                
                // Load user preferences
                this.loadUserPreferences();
            }

            /**
             * Finalize boot process
             */
            async finalizeBoot() {
                // Show system ready message
                const stats = dataManager.getStatistics();
                const message = `Sistem hazƒ±r - ${stats.total} kayƒ±t y√ºklendi`;
                
                // Add slight delay for better UX
                setTimeout(() => {
                    toast.show(message, 'success', 4000);
                }, 500);
                
                // Log system information
                this.logSystemInfo();
            }

            /**
             * Handle successful initialization
             */
            onInitializationComplete() {
                console.log('‚ú® SOMTECH_SOF v1.9.8 - System Ready');
                document.body.setAttribute('data-system-ready', 'true');
                
                // Dispatch custom event for other components
                window.dispatchEvent(new CustomEvent('somtech:system-ready', {
                    detail: {
                        version: '1.9.8',
                        timestamp: new Date().toISOString(),
                        components: ['toast', 'theme', 'i18n', 'roles', 'ai', 'sof', 'data', 'table']
                    }
                }));
            }

            /**
             * Handle initialization errors
             * @param {Error} error - Initialization error
             */
            onInitializationError(error) {
                console.error('‚ùå System Initialization Failed:', error);
                
                // Show error to user
                if (window.toast) {
                    toast.show('Sistem ba≈ülatƒ±lƒ±rken hata olu≈ütu', 'error', 8000);
                } else {
                    // Fallback if toast system failed
                    const errorDiv = document.createElement('div');
                    errorDiv.style.cssText = `
                        position: fixed; top: 20px; right: 20px; z-index: 9999;
                        background: #ef4444; color: white; padding: 16px;
                        border-radius: 8px; font-family: sans-serif;
                    `;
                    errorDiv.textContent = 'Sistem ba≈ülatma hatasƒ±: ' + error.message;
                    document.body.appendChild(errorDiv);
                }
            }

            /**
             * Set default dates for form inputs
             */
            setDefaultDates() {
                const today = new Date().toISOString().split('T')[0];
                const nextWeek = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                
                // Set default request date to today
                const talepTarihiInput = document.getElementById('talep-tarihi');
                if (talepTarihiInput) {
                    talepTarihiInput.value = today;
                }
                
                // Set default deadline to next week
                const terminInput = document.getElementById('termin');
                if (terminInput) {
                    terminInput.value = nextWeek;
                }
            }

            /**
             * Initialize tooltips and help text
             */
            initializeTooltips() {
                // Add tooltips to AI badges
                const aiBadges = document.querySelectorAll('.ai-badge');
                aiBadges.forEach(badge => {
                    badge.title = 'Bu alan AI tarafƒ±ndan otomatik olarak doldurulur';
                });
                
                // Add help text to complex fields
                const complexFields = document.querySelectorAll('[data-help]');
                complexFields.forEach(field => {
                    const helpText = field.getAttribute('data-help');
                    if (helpText) {
                        field.title = helpText;
                    }
                });
            }

            /**
             * Initialize responsive behavior
             */
            initializeResponsive() {
                // Handle mobile menu if needed
                const handleResize = () => {
                    const isMobile = window.innerWidth < 768;
                    document.body.setAttribute('data-mobile', isMobile);
                };
                
                window.addEventListener('resize', handleResize);
                handleResize(); // Initial call
            }

            /**
             * Initialize navigation system
             */
            initializeNavigation() {
                const navButtons = document.querySelectorAll('.nav-button');
                const pageViews = document.querySelectorAll('.page-view');
                
                navButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        // Remove active class from all buttons
                        navButtons.forEach(btn => btn.classList.remove('active'));
                        // Add active class to clicked button
                        button.classList.add('active');
                        
                        // Show corresponding page
                        const page = button.getAttribute('data-page');
                        this.showPage(page, pageViews);
                    });
                });
            }

            /**
             * Show specific page view
             * @param {string} pageId - Page ID to show
             * @param {NodeList} pageViews - All page view elements
             */
            showPage(pageId, pageViews) {
                // Hide all page views
                pageViews.forEach(view => view.classList.remove('active'));
                
                // Show selected page view
                const targetView = document.getElementById(pageId + '-view');
                if (targetView) {
                    targetView.classList.add('active');
                    
                    // Refresh table if showing records page
                    if (pageId === 'records') {
                        setTimeout(() => tableManager.refresh(), 100);
                    }
                }
            }

            /**
             * Initialize modal system
             */
            initializeModals() {
                // Close modals with Escape key
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        const activeModals = document.querySelectorAll('.modal-overlay.active');
                        activeModals.forEach(modal => {
                            modal.classList.remove('active');
                            document.body.style.overflow = '';
                        });
                    }
                });
                
                // Close modals when clicking overlay
                const modalOverlays = document.querySelectorAll('.modal-overlay');
                modalOverlays.forEach(overlay => {
                    overlay.addEventListener('click', (e) => {
                        if (e.target === overlay) {
                            overlay.classList.remove('active');
                            document.body.style.overflow = '';
                        }
                    });
                });
            }

            /**
             * Initialize form handlers
             */
            initializeForms() {
                // Prevent form submissions from navigating
                const forms = document.querySelectorAll('form');
                forms.forEach(form => {
                    form.addEventListener('submit', (e) => {
                        e.preventDefault();
                        // Form handling is done by specific handlers
                    });
                });
                
                // Auto-save form data
                this.initializeAutoSave();
            }

            /**
             * Initialize auto-save functionality
             */
            initializeAutoSave() {
                const autoSaveFields = document.querySelectorAll('[data-auto-save]');
                autoSaveFields.forEach(field => {
                    let saveTimeout;
                    field.addEventListener('input', () => {
                        clearTimeout(saveTimeout);
                        saveTimeout = setTimeout(() => {
                            const key = field.getAttribute('data-auto-save');
                            localStorage.setItem(`autosave_${key}`, field.value);
                        }, 1000);
                    });
                    
                    // Load saved value
                    const key = field.getAttribute('data-auto-save');
                    const saved = localStorage.getItem(`autosave_${key}`);
                    if (saved) {
                        field.value = saved;
                    }
                });
            }

            /**
             * Initialize keyboard shortcuts
             */
            initializeKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    // Ctrl/Cmd + N: New request
                    if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                        e.preventDefault();
                        const addBtn = document.getElementById('add-record-btn');
                        if (addBtn) addBtn.click();
                    }
                    
                    // Ctrl/Cmd + F: Focus search
                    if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                        e.preventDefault();
                        const searchInput = document.getElementById('search-input');
                        if (searchInput) {
                            searchInput.focus();
                            searchInput.select();
                        }
                    }
                    
                    // Ctrl/Cmd + E: Export data
                    if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
                        e.preventDefault();
                        const exportBtn = document.getElementById('export-btn');
                        if (exportBtn) exportBtn.click();
                    }
                });
            }

            /**
             * Setup auto-refresh for data
             */
            setupAutoRefresh() {
                // Auto-refresh every 5 minutes if enabled
                const settings = dataManager.getSettings();
                if (settings.autoRefresh !== false) {
                    setInterval(() => {
                        tableManager.refresh();
                    }, 5 * 60 * 1000); // 5 minutes
                }
            }

            /**
             * Load user preferences
             */
            loadUserPreferences() {
                const settings = dataManager.getSettings();
                
                // Apply user preferences
                if (settings.defaultBirim) {
                    const birimInput = document.getElementById('ai-birim');
                    if (birimInput) {
                        birimInput.value = settings.defaultBirim;
                    }
                }
            }

            /**
             * Log system information for debugging
             */
            logSystemInfo() {
                const info = {
                    version: '1.9.8',
                    userAgent: navigator.userAgent,
                    language: i18n.getCurrentLanguage(),
                    theme: themeManager.getCurrentTheme(),
                    role: roleManager.getCurrentRole(),
                    dataStats: dataManager.getStatistics(),
                    sofStats: sofGenerator.getStatistics(),
                    aiStats: aiClassifier.getStatistics(),
                    timestamp: new Date().toISOString()
                };
                
                console.log('üìä System Information:', info);
                
                // Store for debugging
                window.SOMTECH_DEBUG = info;
            }
        }

        // ===== FINAL INITIALIZATION =====
        // Initialize the complete application when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            // Start the application initialization sequence
            new ApplicationInitializer();
        });

        // Global error handler for unhandled errors
        window.addEventListener('error', (e) => {
            console.error('Global error:', e.error);
            if (window.toast) {
                toast.show('Beklenmeyen bir hata olu≈ütu', 'error');
            }
        });

        // Global handler for unhandled promise rejections
        window.addEventListener('unhandledrejection', (e) => {
            console.error('Unhandled promise rejection:', e.reason);
            if (window.toast) {
                toast.show('ƒ∞≈ülem tamamlanamadƒ±', 'warning');
            }
        });

        // Configuration object for the Element SDK
        const defaultConfig = {
            app_title: "SOMTECH_SOF v1.9.8",
            nav_overview: "√ñzet",
            nav_records: "Kayƒ±t Tablosu", 
            nav_report_form: "Rapor Formu",
            nav_reports: "Raporlar",
            nav_settings: "Ayarlar",
            nav_new_request: "Yeni Talep Olu≈ütur",
            primary_color: "#22d3ee",
            background_color: "#0f172a",
            text_color: "#f1f5f9",
            surface_color: "#1e293b",
            accent_color: "#06b6d4"
        };

        // Element SDK implementation
        async function onConfigChange(config) {
            // Update text content based on config
            const appTitle = document.getElementById('app-title');
            const navOverview = document.getElementById('nav-overview');
            const navRecords = document.getElementById('nav-records');
            const navReportForm = document.getElementById('nav-report-form');
            const navReports = document.getElementById('nav-reports');
            const navSettings = document.getElementById('nav-settings');
            const navNewRequest = document.getElementById('nav-new-request');

            if (appTitle) appTitle.textContent = config.app_title || defaultConfig.app_title;
            if (navOverview) navOverview.textContent = config.nav_overview || defaultConfig.nav_overview;
            if (navRecords) navRecords.textContent = config.nav_records || defaultConfig.nav_records;
            if (navReportForm) navReportForm.textContent = config.nav_report_form || defaultConfig.nav_report_form;
            if (navReports) navReports.textContent = config.nav_reports || defaultConfig.nav_reports;
            if (navSettings) navSettings.textContent = config.nav_settings || defaultConfig.nav_settings;
            if (navNewRequest) navNewRequest.textContent = config.nav_new_request || defaultConfig.nav_new_request;

            // Update colors
            const root = document.documentElement;
            if (config.primary_color) {
                root.style.setProperty('--accent-color', config.primary_color);
            }
            if (config.background_color) {
                root.style.setProperty('--bg-primary', config.background_color);
            }
            if (config.text_color) {
                root.style.setProperty('--text-primary', config.text_color);
            }
            if (config.surface_color) {
                root.style.setProperty('--bg-secondary', config.surface_color);
            }
            if (config.accent_color) {
                root.style.setProperty('--accent-hover', config.accent_color);
            }
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [
                    {
                        get: () => config.primary_color || defaultConfig.primary_color,
                        set: (value) => {
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ primary_color: value });
                            }
                        }
                    },
                    {
                        get: () => config.background_color || defaultConfig.background_color,
                        set: (value) => {
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ background_color: value });
                            }
                        }
                    },
                    {
                        get: () => config.text_color || defaultConfig.text_color,
                        set: (value) => {
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ text_color: value });
                            }
                        }
                    },
                    {
                        get: () => config.surface_color || defaultConfig.surface_color,
                        set: (value) => {
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ surface_color: value });
                            }
                        }
                    },
                    {
                        get: () => config.accent_color || defaultConfig.accent_color,
                        set: (value) => {
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ accent_color: value });
                            }
                        }
                    }
                ],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ["app_title", config.app_title || defaultConfig.app_title],
                ["nav_overview", config.nav_overview || defaultConfig.nav_overview],
                ["nav_records", config.nav_records || defaultConfig.nav_records],
                ["nav_report_form", config.nav_report_form || defaultConfig.nav_report_form],
                ["nav_reports", config.nav_reports || defaultConfig.nav_reports],
                ["nav_settings", config.nav_settings || defaultConfig.nav_settings],
                ["nav_new_request", config.nav_new_request || defaultConfig.nav_new_request]
            ]);
        }

        // Initialize Element SDK
        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                onConfigChange,
                mapToCapabilities,
                mapToEditPanelValues
            });
        }
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9937d6dc7602e34c',t:'MTc2MTI5MTc2NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
